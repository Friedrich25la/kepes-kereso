<!doctype html>
<html lang="hu">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Termékkereső 8.7 — Trinexus (Szezonális logika + Szállítás)</title>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,100..1000&family=Jersey+10&family=Asap:wght@400;500;600&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <script>window.MIN_TOKEN_LEN = window.MIN_TOKEN_LEN || 3;</script>
  <script>window.API_BASE = 'https://aquamarine-cactus-d0f609.netlify.app/.netlify/functions/search';</script>

  <style>
    /* =========================================
       0. FONTOK
       ========================================= */
    @font-face {
      font-family: 'Gentona';
      src: url('Gentona-Bold.otf') format('opentype'),
        url('Gentona-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }

    @font-face {
      font-family: 'Gentona';
      src: url('Gentona-Light.otf') format('opentype'),
        url('Gentona-Light.ttf') format('truetype');
      font-weight: 300;
      font-style: normal;
    }

    /* =========================================
       1. ALAP STÍLUSOK
       ========================================= */
    :root {
      --accent: #33CCBE;
      --bg: #edebebe9;
      --muted: #666;
      --text-main: #111;
      --card-bg: #fff;
      --card-border: #eee;
      --header-bg: #919090;

      --thumb: 150px;
      --gap: 12px;
      --overlay-height: 38px;
      --max-width: 1200px;
      --card-width: 180px;
      --sidebar-width: 320px;
      --accent-dark: #28a398;

      --glow-backdrop: hsl(0 0% 60% / 0.12);
      --border: 9;
      --backup-border: var(--glow-backdrop);
      --radius: 12px;

      /* Custom Scrollbar Változók */
      --desc-modal-bg: #f4f4f4;
      --scroll-track: rgba(0, 0, 0, 0.05);
      --scroll-thumb: var(--accent);
      --corner-radius: var(--radius);
    }

    body:has(.switcher__input[value="dark"]:checked) {
      --bg: #3a3a3a;
      --text-main: #e1e1e1;
      --muted: #aaa;
      --card-bg: #2a2a2c;
      --card-border: #444;
      --header-bg: #2e2d2d;
      --accent: #33CCBE;
      --accent-dark: #28a398;
      --glow-backdrop: rgba(255, 255, 255, 0.05);

      --desc-modal-bg: #444446;
      --scroll-track: rgba(255, 255, 255, 0.05);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
      margin: 0;
      background: var(--bg);
      color: var(--text-main);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      transition: background 0.4s ease, color 0.4s ease;
    }

    .container {
      max-width: var(--max-width);
      margin: 18px auto;
      padding: 18px;
    }

    /* HEADER */
    .site-header {
      width: 100%;
      background: var(--header-bg);
      position: relative;
      padding: 12px 0;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      z-index: 100;
      transition: background 0.4s ease;
    }

    .header-wrap {
      max-width: var(--max-width);
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 5px 56px;
      position: relative;
    }

    .logo-link {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      display: inline-block;
      z-index: 5;
      text-decoration: none;
    }

    .logo {
      height: 44px;
      width: auto;
      display: block;
    }

    .text {
      font-family: 'Gentona', sans-serif;
      font-size: 2.2vw;
      color: #f8f7f7;
      position: relative;
      z-index: 3;
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .brand-main {
      font-weight: 700;
      margin-right: 6px;
    }

    .brand-sub {
      font-weight: 300;
      opacity: 0.9;
    }

    @media (max-width: 480px) {
      .text {
        font-size: 5vw;
        margin: 0 30px;
      }
    }

    /* KERESŐ SÁV */
    .search-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 25px;
      justify-content: center;
    }

    .search-row input.search {
      flex: 1;
      min-width: 320px;
      padding: 12px 14px;
      border: 1px solid var(--card-border);
      border-radius: 12px;
      font-size: 16px;
      outline: none;
      background: var(--card-bg);
      color: var(--text-main);
    }

    .controls-row {
      display: flex;
      gap: 30px;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      background: var(--card-bg);
      padding: 10px 20px;
      border-radius: 16px;
      border: 1px solid var(--card-border);
      position: relative;
      z-index: 50;
    }

    .controls-row input[type=checkbox] {
      padding: 6px;
      border-radius: 6px;
      border: 1px solid var(--card-border);
      background: var(--bg);
    }

    /* DROPDOWN */
    .field.menu {
      font-family: Asap, system-ui, sans-serif;
      position: relative;
      flex: 1;
      min-width: 160px;
      max-width: 260px;
    }

    .field.menu .control {
      position: relative;
    }

    .field.menu button {
      font-size: 14px;
      text-align: start;
      border-radius: var(--radius);
      padding: 8px 14px;
      padding-inline-end: 30px;
      width: 100%;
      transition: all 0.3s cubic-bezier(0.33, 1, 0.68, 1);
      background: var(--card-bg);
      color: var(--text-main);
      border: 1px solid var(--card-border);
      cursor: pointer;
      position: relative;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .field.menu button::after {
      content: '';
      position: absolute;
      right: 14px;
      top: 50%;
      width: 10px;
      height: 6px;
      background-color: var(--muted);
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform: translateY(-50%);
      transition: transform 0.3s;
    }

    .field.menu.open button::after {
      transform: translateY(-50%) rotate(180deg);
    }

    .field.menu button:hover {
      border-color: var(--accent);
    }

    .field.menu menu {
      background: var(--card-bg);
      padding: 6px;
      margin: 0;
      border-radius: calc(var(--radius) * 1.2);
      display: none;
      flex-direction: column;
      gap: 4px;
      position: absolute;
      top: calc(100% + 8px);
      width: 100%;
      min-width: 220px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
      border: 1px solid var(--card-border);
      z-index: 9999;
      opacity: 0;
      scale: 1 0.9;
      transition: opacity 0.2s, scale 0.2s;
      list-style: none;
      max-height: 400px;
      overflow-y: auto;
    }

    .field.menu.open menu {
      display: flex;
      opacity: 1;
      scale: 1 1;
    }

    .field.menu menu li {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
    }

    .field.menu menu li svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .field.menu menu li>* {
      margin: 0;
    }

    .field.menu menu li h3 {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    .field.menu menu li:hover,
    .field.menu menu li:focus {
      background: rgba(51, 204, 190, 0.1);
    }

    .field.menu menu li.selected {
      background: rgba(51, 204, 190, 0.15);
    }

    /* SLIDER */
    #slider-wrapper {
      display: flex;
      align-items: center;
      gap: 0;
      width: 240px;
      flex: 0 0 240px;
      position: relative;
      height: 40px;
      padding: 0 10px;
      margin-top: 5px;
    }

    #slider {
      flex: 1;
      position: relative;
      --range-slider: #e0e0e0;
      --range-handle: var(--accent);
      --range-handle-inactive: #999;
      --range-handle-focus: var(--accent-dark);
      --range-range: var(--accent);
      --range-pip: var(--muted);
    }

    body:has(.switcher__input[value="dark"]:checked) #slider {
      --range-slider: #444;
    }

    .price-label {
      font-family: "Jersey 10", monospace;
      font-size: 1.1em;
      color: var(--text-main);
      position: absolute;
      top: -14px;
      pointer-events: none;
      transition: transform 0.2s ease, left 0.2s;
      white-space: nowrap;
      font-weight: normal;
      transform: translateX(-50%);
    }

    #price-min {
      translate: calc((var(--slider-length) * (var(--pos) / 100) * 1px)) 0;
    }

    #price-max {
      translate: calc((var(--slider-length) * (var(--pos) / 100) * 1px)) 0;
    }

    .rangeSlider {
      height: 4px !important;
      border-radius: 2px !important;
      margin: 0 !important;
    }

    .rangeHandle {
      transform: none !important;
      border-radius: 50% !important;
      width: 16px !important;
      height: 16px !important;
      top: -6px !important;
      background: var(--accent) !important;
      border: none !important;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .rangeHandle::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      background: inherit;
      border-radius: 50% 50% 0 50%;
      transform: rotate(-45deg);
      top: 0;
      left: 0;
      z-index: -1;
    }

    .rangeBar {
      height: 4px !important;
      background: var(--accent) !important;
    }

    /* AMAZON GRID STYLES */
    .amz-grid-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 30px 0;
      width: 100%;
    }

    .amz-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 8px;
      padding: 20px;
      flex: 1;
      min-width: 260px;
      max-width: 350px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      color: var(--text-main);
      position: relative;
    }

    .amz-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text-main);
    }

    .amz-grid-inner {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      flex: 1;
      margin-bottom: 15px;
    }

    .amz-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .amz-item a {
      display: block;
      text-decoration: none;
      color: inherit;
    }

    .amz-item img {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 4px;
      background: #f0f0f0;
      transition: transform 0.2s;
      cursor: pointer;
    }

    .amz-item a:hover img {
      transform: scale(1.05);
    }

    .amz-item span {
      font-size: 12px;
      color: var(--muted);
      white-space: normal;
      line-height: 1.3;
      text-align: center;
      display: block;
      margin-top: 4px;
      transition: color 0.2s;
      cursor: pointer;
    }

    .amz-item a:hover+span,
    .amz-item span:hover {
      color: var(--accent);
    }

    a.amz-footer {
      font-size: 13px;
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
      margin-top: auto;
      display: inline-block;
    }

    a.amz-footer:hover {
      text-decoration: underline;
      color: var(--accent-dark);
    }


    /* RESULTS */
    .results-meta {
      text-align: right;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      margin-right: 8px;
      font-weight: 500;
    }

    .results {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      min-height: 120px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-start;
    }

    /* CARD STYLES */
    .card {
      width: var(--card-width);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      overflow: visible;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
      cursor: pointer;
      text-decoration: none;
      color: inherit;
      transition: transform .14s ease, box-shadow .14s ease;
      position: relative;
      isolation: isolate;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.12);
      z-index: 10;
    }

    [data-glow] {
      --border-size: calc(var(--border, 2) * 1px);
      --spotlight-size: calc(var(--size, 150) * 1px);
      --hue: calc(var(--base, 190) + (var(--xp, 0) * var(--spread, 0)));
      background-image: radial-gradient(var(--spotlight-size) var(--spotlight-size) at calc(var(--x, 0) * 1px) calc(var(--y, 0) * 1px),
          hsl(var(--hue, 210) calc(var(--saturation, 100) * 1%) calc(var(--lightness, 70) * 1%) / var(--bg-spot-opacity, 0.1)), transparent);
      background-color: var(--glow-backdrop, transparent);
      background-size: calc(100% + (2 * var(--border-size))) calc(100% + (2 * var(--border-size)));
      background-position: 50% 50%;
      background-attachment: fixed;
      border: var(--border-size) solid var(--backup-border);
      position: relative;
      touch-action: none;
      border-radius: 12px;
      z-index: 1;
    }

    [data-glow]::before,
    [data-glow]::after {
      pointer-events: none;
      content: "";
      position: absolute;
      inset: calc(var(--border-size) * -1);
      border: var(--border-size) solid transparent;

      border-radius: calc(12px + var(--border-size));

      background-attachment: fixed;
      background-size: calc(100% + (2 * var(--border-size))) calc(100% + (2 * var(--border-size)));
      background-repeat: no-repeat;
      background-position: 50% 50%;
      mask: linear-gradient(transparent, transparent), linear-gradient(white, white);
      mask-clip: padding-box, border-box;
      mask-composite: intersect;
    }

    [data-glow]::before {
      background-image: radial-gradient(calc(var(--spotlight-size) * 0.75) calc(var(--spotlight-size) * 0.75) at calc(var(--x, 0) * 1px) calc(var(--y, 0) * 1px),
          hsl(var(--hue, 210) calc(var(--saturation, 100) * 1%) calc(var(--lightness, 50) * 1%) / var(--border-spot-opacity, 1)), transparent 100%);
      filter: brightness(2);
      z-index: 0;
    }

    [data-glow]::after {
      background-image: radial-gradient(calc(var(--spotlight-size) * 0.5) calc(var(--spotlight-size) * 0.5) at calc(var(--x, 0) * 1px) calc(var(--y, 0) * 1px),
          hsl(var(--hue, 210) calc(var(--saturation, 100) * 1%) calc(92 * 1%) / var(--border-light-opacity, 0.85)), transparent 100%);
    }

    .card-bg {
      position: absolute;
      inset: 0;
      background: var(--card-bg);
      border-radius: 12px;
      z-index: 0;
    }

    .card img {
      width: 100%;
      height: var(--thumb);
      object-fit: cover;
      display: block;
      background: #f6f6f6;
      border-radius: 12px 12px 0 0;
    }

    .card>.overlay,
    .card>.meta {
      position: relative;
      z-index: 2;
    }

    .overlay {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .name-bar {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: var(--overlay-height);
      display: flex;
      align-items: center;
      padding: 6px 8px;
      background: rgba(0, 0, 0, 0.45);
      color: #fff;
      font-size: 12px;
      backdrop-filter: blur(2px);
    }

    .meta {
      padding: 8px 10px;
      border-top: 1px solid #f4f4f4;
      font-size: 13px;
      background: var(--card-bg);
      color: var(--text-main);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      border-radius: 0 0 12px 12px;
    }

    .meta .price {
      font-weight: 700;
    }

    /* ÚJ: Custom Checkbox Stílusok (ZIP alapján, témára igazítva) */
    .checkbox-column {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 8px; /* Távolság a két sor között */
      margin-left: 10px;
    }

    /* Eltüntetjük az alap checkboxot */
    .checkbox-column input[type="checkbox"] {
      display: none;
    }

    /* A szöveg és a doboz helye */
    .checkbox-column label {
      position: relative;
      padding-left: 26px; /* Hely a doboznak */
      cursor: pointer;
      font-size: 13px; /* Kicsit kisebb betű, hogy elférjen */
      line-height: 18px;
      color: var(--text-main);
      user-select: none;
      display: block;
      font-weight: 500;
      transition: color 0.2s;
      margin: 0; /* Reset */
    }

    .checkbox-column label:hover {
      color: var(--accent);
    }

    /* A doboz (Üres állapot) */
    .checkbox-column label:before {
      content: '';
      display: block;
      width: 16px;  /* Kompakt méret */
      height: 16px;
      border: 1px solid var(--muted); /* Alapból szürke keret */
      position: absolute;
      left: 0;
      top: 1px;
      opacity: 0.6;
      transition: all .12s, border-color .08s;
      border-radius: 3px; /* Picit kerekített, modernebb */
    }

    /* Hover állapot a dobozon */
    .checkbox-column input[type="checkbox"] + label:hover:before {
      border-color: var(--accent);
    }

    /* Pipa állapot (Animáció a ZIP-ből) */
    /* Pipa állapot (Animáció a ZIP-ből - JAVÍTVA) */
    .checkbox-column input[type="checkbox"]:checked + label:before {
      width: 8px; /* Szűkebb lesz, ettől lesz pipa alakja */
      top: -4px;  /* Pozíció igazítás */
      left: 5px;
      
      border-radius: 0;
      opacity: 1;

      /* FONTOS A SORREND! */
      /* 1. Először megadjuk a színt és vastagságot minden oldalra */
      border: 2px solid var(--accent); 

      /* 2. ÉS CSAK UTÁNA tüntetjük el a felső és bal oldalt */
      border-top-color: transparent;
      border-left-color: transparent;

      /* Forgatás */
      transform: rotate(45deg);
    }

    /* UI ELEMENTS */
    .fav-icon {
      position: absolute;
      top: 8px;
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
      transition: all 0.2s ease;
      z-index: 20;
      right: 8px;
      color: #ccc;
    }

    .fav-icon:hover {
      transform: scale(1.15);
      background: #fff;
    }

    .fav-icon.active {
      color: #FFD700;
    }

    .fav-icon svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    /* RÖVID LEÍRÁS IKON (SZEM) - KÁRTYÁN */
    .desc-icon {
      position: absolute;
      top: 8px;
      left: 8px;
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
      transition: all 0.2s ease;
      z-index: 20;
      color: var(--accent);
    }

    .desc-icon:hover {
      transform: scale(1.15);
      background: #fff;
    }

    .desc-icon svg {
      width: 18px;
      height: 18px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .desc-icon[aria-label]:hover::after {
      content: attr(aria-label);
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      pointer-events: none;
    }

    /* FANCY GOMB */
    .fancy-btn-container {
      display: flex;
      justify-content: center;
      padding: 40px 0;
      width: 100%;
    }

    .fancy-btn {
      --size: 18px;
      font-size: var(--size);
      font-family: inherit;
      appearance: none;
      background: transparent;
      padding: 1em 2em;
      border-radius: 100px;
      border: 1px solid #ccc;
      color: var(--text-main);
      position: relative;
      overflow: hidden;
      transition: color .40s ease;
      cursor: pointer;
      font-weight: 600;
      z-index: 1;
    }

    .fancy-btn:hover {
      color: #000;
      border-color: #333;
    }

    .fancy-btn .btn-content {
      pointer-events: none;
      position: relative;
      z-index: 3;
    }

    .fancy-btn .btn-cells {
      position: absolute;
      z-index: 2;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-auto-rows: 1fr;
      overflow: hidden;
    }

    .fancy-btn .btn-cells span {
      width: 100%;
      height: 100%;
      display: block;
      position: relative;
    }

    .fancy-btn .btn-cells span:before {
      content: "";
      display: block;
      position: absolute;
      width: 50px;
      height: 50px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: var(--accent);
      background-image: linear-gradient(to right, var(--accent), #fff);
      transition: transform .4s ease;
      border-radius: 100px;
      opacity: 0.8;
    }

    .fancy-btn .btn-cells span:hover:before {
      transform: translate(-50%, -50%) scale(12);
    }

    /* SIDEBAR */
    #fav-sidebar {
      position: fixed;
      top: 0;
      right: -320px;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--card-bg);
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      z-index: 12000;
      transition: right 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
      display: flex;
      flex-direction: column;
      color: var(--text-main);
    }

    #fav-sidebar.open {
      right: 0;
    }

    .sidebar-tabs {
      display: flex;
      background: var(--bg);
      border-bottom: 1px solid var(--card-border);
    }

    .sidebar-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: var(--muted);
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .sidebar-tab.active {
      color: var(--text-main);
      border-bottom-color: var(--accent);
      background: var(--card-bg);
    }

    .close-sidebar-abs {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      background: none;
      border: none;
    }

    .sidebar-content-wrapper {
      flex: 1;
      overflow-y: auto;
      position: relative;
    }

    .sidebar-pane {
      display: none;
      padding: 10px;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar-pane.active {
      display: flex;
    }

    /* History Styles */
    .history-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--muted);
      margin: 15px 0 5px;
      font-weight: bold;
      border-bottom: 1px solid var(--card-border);
      padding-bottom: 4px;
    }

    .history-tag {
      display: inline-block;
      padding: 4px 10px;
      background: var(--bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      font-size: 13px;
      margin: 0 5px 5px 0;
      cursor: pointer;
      transition: background 0.2s;
    }

    .history-tag:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .fav-item {
      display: flex;
      gap: 10px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      padding: 8px;
      border-radius: 4px;
      align-items: center;
      position: relative;
      transition: transform 0.2s;
    }

    .fav-item:hover {
      transform: translateX(-2px);
      border-color: var(--accent);
    }

    .fav-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 3px;
      cursor: pointer;
      border: 1px solid #eee;
    }

    .fav-info {
      flex: 1;
      overflow: hidden;
    }

    .fav-name {
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 2px;
    }

    .fav-price {
      font-size: 12px;
      color: var(--muted);
      font-weight: bold;
    }

    .remove-fav {
      color: #999;
      cursor: pointer;
      padding: 4px;
      font-size: 18px;
      line-height: 1;
    }

    .remove-fav:hover {
      color: #ff4444;
    }

    .sidebar-footer {
      padding: 15px;
      border-top: 1px solid var(--card-border);
      background: var(--bg);
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-btn {
      display: block;
      width: 100%;
      padding: 12px;
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      font-weight: 600;
      font-size: 14px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .sidebar-btn:hover {
      background: var(--accent-dark);
    }

    .clear-btn {
      background: transparent;
      color: #d9534f;
      border: 1px solid #d9534f;
      font-size: 12px;
      padding: 8px;
    }

    .clear-btn:hover {
      background: #d9534f;
      color: #fff;
    }

    /* LEBEGŐ GOMB (KEDVENCEK) */
    #fav-trigger {
      position: fixed;
      top: 130px;
      right: 0;
      background: var(--accent);
      color: #fff;
      padding: 10px 15px 10px 12px;
      border-radius: 20px 0 0 20px;
      box-shadow: -2px 2px 5px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 1100;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      transition: right 0.3s;

      width: auto;
      min-width: 140px;
      justify-content: flex-start;
    }

    #fav-trigger:hover {
      padding-right: 20px;
    }

    body.sidebar-open #fav-trigger {
      right: -100px;
    }

    #fav-count {
      background: #fff;
      color: var(--accent);
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: bold;
      margin-left: auto;
    }

    /* KATEGÓRIA GOMB */
    #cat-trigger {
      position: fixed;
      top: 185px;
      right: 0;
      background: #777;
      color: #fff;
      padding: 10px 15px 10px 12px;
      border-radius: 20px 0 0 20px;
      box-shadow: -2px 2px 5px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 899;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      transition: right 0.3s;

      width: auto;
      min-width: 140px;
      justify-content: flex-start;
    }

    #cat-trigger:hover {
      padding-right: 20px;
    }

    body.sidebar-open #cat-trigger {
      right: -100px;
    }

    .mobile-star {
      display: none;
    }

    /* SWITCHER */
    .switcher {
      position: absolute;
      right: -140px;
      top: 50%;
      transform: translateY(-50%) scale(0.35);
      transform-origin: right center;
      z-index: 20;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 154px;
      height: 70px;
      box-sizing: border-box;
      padding: 8px 12px 10px;
      border: none;
      border-radius: 99em;
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .switcher__legend,
    .switcher__input,
    .switcher__filter {
      position: absolute;
      width: 0;
      height: 0;
      overflow: hidden;
      opacity: 0;
    }

    .switcher__option {
      --c: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 16px;
      width: 68px;
      height: 100%;
      box-sizing: border-box;
      border-radius: 99em;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    .switcher__option:hover .switcher__icon {
      transform: scale(1.2);
    }

    .switcher__icon {
      width: 24px;
      height: 24px;
      fill: var(--text-main);
      transition: transform 0.2s;
    }

    .switcher::after {
      content: '';
      position: absolute;
      left: 4px;
      top: 4px;
      display: block;
      width: 68px;
      height: calc(100% - 10px);
      border-radius: 99em;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 1;
      transition: transform 0.4s cubic-bezier(1, 0.0, 0.4, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .switcher:has(input[value="light"]:checked)::after {
      transform: translateX(0);
    }

    .switcher:has(input[value="dark"]:checked)::after {
      transform: translateX(76px);
    }

    /* ANIMÁCIÓ */
    .flying-img {
      position: fixed;
      z-index: 9999;
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 50%;
      pointer-events: none;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      top: 0;
      left: 0;
    }

    .fly-container {
      position: fixed;
      z-index: 9999;
      top: 0;
      left: 0;
      pointer-events: none;
      transition: transform 0.8s ease-in;
    }

    .fly-inner {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      background: #fff;
      border: 2px solid var(--accent);
      transition: transform 0.8s ease-out;
    }

    .fly-inner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* =========================================
       MODAL ÉS CUSTOM SCROLLBAR STÍLUSOK
       ========================================= */

    /* Modal Háttér (Overlay) */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
    }

    .modal-overlay.active {
      display: flex;
    }

    /* Modal Doboz */
    .desc-modal {
      background: var(--desc-modal-bg);
      width: 90%;
      max-width: 500px;
      border-radius: 16px;
      padding: 20px;
      position: relative;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      color: var(--text-main);
      border: 1px solid var(--card-border);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .close-modal-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      background: none;
      border: none;
      color: var(--muted);
      z-index: 10;
    }

    #desc-modal-title {
      margin: 0;
      padding-right: 30px;
      font-size: 18px;
      color: var(--text-main);
      line-height: 1.3;
    }

    /* ÚJ: Modal Info Sorok (Image + Price + Shipping) */
    .modal-info-row {
        display: flex;
        align-items: center;
        gap: 15px;
        width: 100%;
    }
    
    .mini-thumb {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid var(--card-border);
        background: #fff;
        flex-shrink: 0;
    }

    /* Ár közvetlenül a kép mellett */
    .modal-price {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-main);
        white-space: nowrap;
    }
    
    /* Szállítási blokk a jobb szélen */
    .shipping-block {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 4px;
        margin-left: auto; /* Ez tolja ki a jobb szélre */
        align-items: flex-end; /* Jobbra igazítja a szöveget és ikonokat */
    }
    
    .shipping-label {
        font-size: 11px; /* Picit nagyobb betű */
        color: var(--muted);
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
    }
    
    .shipping-icons {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    
    .shipping-icon {
        height: 32px; /* Nagyobb ikonok (24px helyett) */
        width: auto;
        object-fit: contain;
    }
    .modal-meta-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      /* Nagyobb térköz */
      align-items: flex-start;
      margin-top: 4px;
    }

    .warranty-badge {
      background-color: var(--accent);
      color: #fff;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 10px;
      border-radius: 99em;
    }

    .sales-text {
      font-size: 14px;
      /* Megnövelt betűméret */
      color: #a9a9a9;
      /* Figyelemfelhívóbb szín */
      font-weight: 600;
      /* Félkövér */
      font-style: normal;
    }

    /* ÚJ: Modal Footer */
    .modal-footer {
      display: flex;
      gap: 10px;
      margin-top: 5px;
      border-top: 1px solid var(--card-border);
      padding-top: 12px;
    }

    .modal-action-btn {
      flex: 1;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--card-border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--muted);
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .modal-action-btn:hover {
      background: var(--card-bg);
      color: var(--accent);
      border-color: var(--accent);
    }

    .modal-action-btn.active {
      color: #FFD700;
      border-color: #FFD700;
      background: #fff;
    }

    .modal-action-btn svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    /* Tooltip a modal gombokhoz */
    .modal-action-btn[title]:hover::after {
      content: attr(title);
      position: absolute;
      bottom: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      pointer-events: none;
      margin-bottom: 5px;
    }

    /* --- CUSTOM SCROLLBAR CONTAINER --- */
    .desc-scroll-container {
      height: 200px;
      /* Kicsit kisebb, hogy minden kiférjen */
      width: 100%;
      background: var(--desc-modal-bg);
      border-radius: var(--corner-radius);
      position: relative;
      mask:
        radial-gradient(var(--corner-radius) at var(--corner-radius) var(--corner-radius), #0000 98%, #000) 0 0 / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at calc(100% - var(--corner-radius)) var(--corner-radius), #0000 98%, #000) 100% 0 / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at var(--corner-radius) calc(100% - var(--corner-radius)), #0000 98%, #000) 0 100% / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at calc(100% - var(--corner-radius)) calc(100% - var(--corner-radius)), #0000 98%, #000) 100% 100% / 51% 51% no-repeat,
        linear-gradient(#000 0 0) center / 100% calc(100% - 2 * var(--corner-radius)) no-repeat,
        linear-gradient(#000 0 0) center / calc(100% - 2 * var(--corner-radius)) 100% no-repeat;
      -webkit-mask:
        radial-gradient(var(--corner-radius) at var(--corner-radius) var(--corner-radius), #0000 98%, #000) 0 0 / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at calc(100% - var(--corner-radius)) var(--corner-radius), #0000 98%, #000) 100% 0 / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at var(--corner-radius) calc(100% - var(--corner-radius)), #0000 98%, #000) 0 100% / 51% 51% no-repeat,
        radial-gradient(var(--corner-radius) at calc(100% - var(--corner-radius)) calc(100% - var(--corner-radius)), #0000 98%, #000) 100% 100% / 51% 51% no-repeat,
        linear-gradient(#000 0 0) center / 100% calc(100% - 2 * var(--corner-radius)) no-repeat,
        linear-gradient(#000 0 0) center / calc(100% - 2 * var(--corner-radius)) 100% no-repeat;
    }

    .desc-content {
      height: 100%;
      width: 100%;
      overflow-y: auto;
      padding: 15px;
      padding-right: 25px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-main);
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .desc-content::-webkit-scrollbar {
      display: none;
    }

    .scrollbar-track {
      position: absolute;
      top: var(--corner-radius);
      right: 5px;
      width: 10px;
      height: calc(100% - 2 * var(--corner-radius));
      background: var(--scroll-track);
      border-radius: 10px;
      z-index: 10;
    }

    .scrollbar-thumb {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--scroll-thumb);
      border-radius: 10px;
      cursor: grab;
    }

    .scrollbar-thumb:active {
      cursor: grabbing;
    }

   /* =========================================
       MOBIL NÉZET JAVÍTÁSOK (HEADER + KERESŐ)
       ========================================= */
    /* =========================================
       MOBIL NÉZET - MINDEN EGYBEN (HEADER + KERESŐ + MENÜ)
       ========================================= */
    @media (max-width: 480px) {
      
      /* --- 1. HEADER ÉS LOGO --- */
      .header-wrap {
        padding: 0 10px;
        width: 100%;
        justify-content: center;
      }

      .logo {
        height: 20px;
      }

      .text {
        font-size: 13px; /* Kisebb cím */
        margin: 0 15px;  
      }

      .switcher {
        transform: translateY(-50%) scale(0.4) !important;
        right: -5px !important;
        top: 50%;
        width: 154px;
      }

      .container {
        padding-right: 12px;
      }

      /* --- 2. OLDALSÁVOK ÉS LEBEGŐ GOMBOK --- */
      #fav-sidebar {
        width: 100%;
        right: -100%;
      }

      #fav-trigger {
        top: auto;
        bottom: 45px;
        right: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        padding: 0;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        min-width: 0;
      }

      #cat-trigger {
        top: auto;
        bottom: 110px;
        right: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        padding: 0;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        min-width: 0;
      }

      #fav-trigger .label-text,
      #cat-trigger .label-text {
        display: none;
      }

      .mobile-star {
        display: block;
        fill: #fff;
        width: 24px;
        height: 24px;
      }

      #fav-count {
        position: absolute;
        top: -2px;
        right: -2px;
        border: 2px solid var(--accent);
        width: 20px;
        height: 20px;
        font-size: 11px;
      }

      /* --- 3. KERESŐSÁV JAVÍTÁSA (Hogy kiférjen a gomb mellett) --- */
      .search-row input.search {
        min-width: 0; 
        flex: 1;      
        width: auto;
      }
      
      .cat-menu-trigger {
        padding: 0 8px; /* Kisebb belső margó */
        font-size: 13px;
        max-width: 110px; 
      }
      
      .cat-menu-trigger::after {
          margin-left: 2px;
      }

      /* --- 4. EGYÉB UI ELEMEK --- */
      .toggle { width: 100%; }
      .card { width: 100%; }
      .controls-row {
        flex-direction: column;
        gap: 20px;
        align-items: stretch;
      }
      .field.menu { min-width: 100%; max-width: 100%; }
      #slider-wrapper {
        width: 100%;
        max-width: 100%;
        margin-top: 15px;
        flex: 1;
      }
      .amz-card { max-width: 100%; }
      .desc-modal { width: 95%; }

      /* ========================================================= */
      /* 5. A MENÜ MOBIL JAVÍTÁSA (EZ A LÉNYEG!)                   */
      /* ========================================================= */
      
      /* A konténer ne legyen fix széles (900px), hanem rugalmas */
      .mm-container {
        width: 100% !important; /* Teljes szélesség a szülőhöz képest */
        min-width: 0 !important;
        left: 0 !important;
        margin-left: 0 !important;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        max-height: 60vh; /* Ha túl hosszú, lehessen görgetni */
        overflow-y: auto;
      }
      
      /* Kényszerített 1 OSZLOPOS megjelenítés */
      ul.mm-root {
        column-count: 1 !important; 
        column-gap: 0 !important;
        display: block !important;
        height: auto !important;
      }
      
      /* Menüpontok stílusa mobilon */
      li.mm-item {
        display: block !important;
        width: 100% !important;
        border-bottom: 1px solid #f0f0f0; /* Kis elválasztó vonal */
      }
      
      a.mm-link {
         padding: 12px 15px; /* Nagyobb érintési felület */
         font-size: 14px;
      }

      /* MOBILON ELREJTJÜK AZ OLDALRA NYÍLÓ ALMENÜT */
      /* Mert mobilon nincs "hover", és a kattintás a főkategóriára visz */
      .mm-panel {
          display: none !important; 
      }
      
      /* A "has-sub" nyilacskákat is elrejtjük mobilon, ne tévesszen meg */
      li.mm-item.has-sub > a.mm-link::after {
          display: none !important;
      }
    }
    /* ================= MENU.JS STÍLUSOK (3 OSZLOPOS FŐMENÜ FIX) ================= */
    
    .search-row {
        position: relative;
        z-index: 1000;
    }
    .search-wrapper-combined {
        display: flex;
        width: 100%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 12px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        position: relative;
        transition: background 0.4s ease, border-color 0.4s ease;
    }

    /* GOMB */
    .cat-menu-trigger {
        background-color: transparent;
        color: var(--text-main);
        padding: 0 15px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        border-radius: 12px 0 0 12px;
        display: flex; 
        align-items: center; 
        gap: 8px;
        white-space: nowrap;
        min-width: auto;
        border-right: 1px solid var(--card-border);
        transition: color 0.3s;
        position: relative;
        z-index: 10001;
    }
    
    .cat-menu-trigger:hover {
        color: var(--accent);
    }
    
    .cat-menu-trigger::after { 
        content: '';
        border: solid currentColor;
        border-width: 0 2px 2px 0;
        display: inline-block;
        padding: 2px;
        transform: rotate(45deg);
        margin-top: -2px;
    }

    /* OKOS NYITÁS - JAVÍTVA */
    /* Csak a #catMenuBtn (Kategóriák) nyissa meg a menüt, az Aktuális gomb NE! */
    #catMenuBtn:hover ~ .mm-container,
    .mm-container:hover {
        display: block;
        animation: fadeIn 0.2s ease-out;
    }

    /* ================================================================= */
    /* FŐMENÜ KONTÉNER - SZÉLESSÉG JAVÍTÁSA */
    /* ================================================================= */
    .mm-container {
        display: none;
        position: absolute;
        top: 100%; 
        left: 0; 
        
        /* ITT A JAVÍTÁS: 900px széles, hogy biztosan elférjen a 3 oszlop! */
        width: 900px; 
        min-width: 800px;
        
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        z-index: 9999;
        border-radius: 0 8px 8px 8px;
        margin-top: 10px;
        padding: 15px 0;
    }

    .mm-container::before {
        content: '';
        position: absolute;
        top: -15px;
        left: 0;
        width: 100%;
        height: 15px;
        background: transparent;
    }

    /* FŐMENÜ LISTA - 3 OSZLOP */
    ul.mm-root { 
        list-style: none; 
        padding: 0; 
        margin: 0;
        
        /* A szélesebb konténer miatt a böngésző most már engedni fogja a 3 oszlopot */
        column-count: 3; 
        column-gap: 20px;
        column-rule: 1px solid var(--card-border);
    }
    
    li.mm-item {
        break-inside: avoid; /* Ne vágja félbe az elemet */
        page-break-inside: avoid;
        position: relative;
        display: inline-block; /* Segít a stabilitásban */
        width: 100%;
    }
    
    a.mm-link {
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        padding: 8px 15px;
        color: var(--text-main);
        text-decoration: none; 
        font-weight: 500; 
        font-size: 13px;
        transition: all 0.2s;
        border-radius: 4px;
        margin: 0 5px;
        white-space: nowrap; /* Hosszú nevek kezelése */
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    li.mm-item:hover > a.mm-link {
        background-color: var(--bg);
        color: var(--accent);
    }
    
    li.mm-item.has-sub > a.mm-link::after { 
        content: '›'; 
        font-size: 16px; 
        font-weight: bold; 
        color: var(--muted);
    }

    /* ================================================================= */
    /* ALMENÜ PANEL - FÜGGŐLEGES (VERTIKÁLIS) LISTA + GIGA HÍD */
    /* ================================================================= */
    .mm-panel {
        display: block;      
        visibility: hidden;  
        opacity: 0;          
        
        position: absolute;
        
        /* Fontos: Mivel a főmenü most széles, az almenü a szülő elem jobb szélétől nyílik */
        /* Ez azt jelenti, hogy rátakarhat a 2. és 3. oszlopra - ez normális működés */
        left: 100%; 
        top: -5px;  
        margin-left: 0; 
        
        width: 260px; /* Keskeny, vertikális lista */
        
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        box-shadow: 5px 5px 20px rgba(0,0,0,0.15);
        padding: 10px 0;
        border-radius: 4px; 
        z-index: 10000;
        
        transition: opacity 0.2s ease 0.1s, visibility 0s linear 0.3s;
    }

    /* GIGA HÍD - A STABILITÁSÉRT */
    .mm-panel::before {
        content: '';
        position: absolute;
        left: -20px;       
        width: 20px; 
        top: -100vh;
        height: 300vh;
        background: transparent;
        z-index: 1;
    }

    li.mm-item:hover .mm-panel {
        visibility: visible;
        opacity: 1;
        transition-delay: 0s; 
    }

    /* ALMENÜ TARTALOM - SIMA LISTA */
    .mm-grid {
        display: flex;
        flex-direction: column; /* Egymás alá rendezés */
        gap: 0;
    }
    
    .mm-col { margin: 0; padding: 0; }

    /* STÍLUSOK (Címsor és lista elemek) */
    .mm-col-title, 
    ul.mm-sublist a {
        display: flex !important;
        align-items: center;
        padding: 8px 15px;
        color: var(--text-main) !important; 
        text-decoration: none !important;
        font-size: 13px;
        font-weight: 500;
        transition: none; 
        margin: 0;
        border: none;
        background: transparent;
    }

    .mm-col-title:hover,
    ul.mm-sublist a:hover {
        background-color: var(--bg) !important;
        color: var(--accent) !important;
        cursor: pointer;
    }
    /* =========================================
       AKTUÁLIS GALÉRIA & GOMB STÍLUSOK
       ========================================= */

    /* Az új gomb stílusa */
    .current-menu-trigger {
        border-radius: 0 !important; /* Szögletes, mert középen van */
        border-left: 1px solid var(--card-border);
        border-right: 1px solid var(--card-border);
        position: relative;
    }
    
    /* Ha az Aktuális gomb aktív */
    .current-menu-trigger.active {
        color: var(--accent);
        background-color: var(--bg);
    }

    /* GALÉRIA KONTÉNER (Alapállapot: csukva) */
    #gallery-section {
        width: 100%;
        max-width: var(--max-width); /* Ugyanaz a szélesség, mint a container */
        margin: 0 auto 20px auto; /* Kis térköz alul */
        height: 0;
        overflow: hidden;
        position: relative;
        transition: height 0.6s cubic-bezier(0.25, 1, 0.5, 1);
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        opacity: 0;
        /* Rejtett állapotban ne foglaljon helyet a border */
        border: 0px solid transparent; 
    }

    /* NYITOTT ÁLLAPOT */
    #gallery-section.open {
        height: 240px; /* PC magasság */
        opacity: 1;
        border: 1px solid var(--card-border);
        margin-top: -15px; /* Hogy közelebb legyen a keresőhöz */
        margin-bottom: 25px;
    }

    /* Színes csík a tetején (mint a ZIP-ben) */
    .gallery-gradient-bar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #ff00bb, #ff00b6, #ff347a, #ff9829, #ffd500);
        z-index: 2;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.8s ease 0.2s;
    }

    #gallery-section.open .gallery-gradient-bar {
        transform: scaleX(1);
    }

    /* Képek tárolója */
    .gallery-items {
        display: flex;
        width: 100%;
        height: 100%;
        padding: 3px 0 0 0; /* Hely a gradient csíknak */
    }

    /* Egy képkocka */
    .gallery-item {
        flex-grow: 1;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: flex-grow 0.5s ease, opacity 0.3s ease, filter 0.3s;
        cursor: pointer;
        position: relative;
        opacity: 0.8;
        filter: grayscale(0.3);
        min-width: 0; /* Fontos a flexboxhoz */
        display: flex;
        align-items: flex-end;
        justify-content: center;
        overflow: hidden;
    }
    
    /* Szöveg a képen */
    .gallery-label {
        background: rgba(0,0,0,0.6);
        color: white;
        padding: 5px 10px;
        border-radius: 4px 4px 0 0;
        margin-bottom: 0;
        font-size: 13px;
        font-weight: 600;
        transform: translateY(100%); /* Alapból lent van */
        transition: transform 0.3s;
        text-align: center;
        width: 100%;
        backdrop-filter: blur(2px);
    }

    /* HOVER (PC) és ACTIVE (JS által adott osztály) */
    .gallery-item:hover,
    .gallery-item.active {
        flex-grow: 3.5; /* Széthúzás */
        opacity: 1;
        filter: grayscale(0);
    }
    
    .gallery-item:hover .gallery-label,
    .gallery-item.active .gallery-label {
        transform: translateY(0);
    }

    /* Ha egy elem aktív, a többiek menjenek össze kicsit */
    .gallery-items:has(.gallery-item.active) .gallery-item:not(.active) {
        flex-grow: 0.5;
        opacity: 0.5;
    }

    /* MOBIL NÉZET JAVÍTÁS */
    @media (max-width: 480px) {
        /* Gombok igazítása mobilon */
        .cat-menu-trigger {
            border-radius: 12px 0 0 12px; 
            max-width: none;
            flex: 1;
            justify-content: center;
        }
        
        .current-menu-trigger {
            border-radius: 0 12px 12px 0 !important;
            border-right: 1px solid var(--card-border);
            border-left: none;
            flex: 1;
            justify-content: center;
        }
        
        /* A kereső inputnak le kell kerülnie új sorba mobilon, 
           hogy a két gomb elférjen egymás mellett felül */
        .search-wrapper-combined {
            flex-wrap: wrap;
        }
        
        #q.search {
            width: 100%;
            border-radius: 12px !important;
            margin-top: 10px;
            order: 3; /* Harmadik sorba kerül */
            min-width: 100%;
        }

        /* Galéria mobilon: Függőleges harmonika */
        #gallery-section.open {
            height: auto; /* Tartalomhoz igazodjon */
            max-height: 800px; /* Biztonsági limit */
            margin-top: 10px;
        }

        .gallery-items {
            flex-direction: column;
        }

        .gallery-item {
            width: 100%;
            height: 60px; /* Csukott állapot magassága */
            flex-grow: 0; /* Mobilon ne a flex-grow-val játsszunk alapból, hanem height-tel */
            transition: height 0.4s ease;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .gallery-item.active {
            height: 200px; /* Kinyitott magasság mobilon */
            flex-grow: 0;
        }
        
        .gallery-label {
            transform: translateY(0); /* Mobilon mindig látszódjon a felirat */
            background: rgba(0,0,0,0.3);
        }

        /* ========================================================= */
      /* 6. GLOW EFFEKT TILTÁSA MOBILON (GÖRGETÉS JAVÍTÁSA)        */
      /* ========================================================= */
      [data-glow] {
        /* A legfontosabb: visszakapcsoljuk a görgetést! */
        touch-action: auto !important; 
        
        /* Opcionális: A vizuális effekt elrejtése mobilon a gyorsaságért */
        background-image: none !important;
        border: 1px solid var(--card-border) !important;
      }

      /* A fénylő keretek elrejtése */
      [data-glow]::before,
      [data-glow]::after {
        display: none !important;
      }
      
      /* A kártya ne "ugorjon" fel mobilon érintéskor */
      .card:hover, .card:active {
        transform: none !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04) !important;
        z-index: 1 !important;
      }
    }
    /* =========================================
       TOP KATEGÓRIÁK (KÁRTYA DESIGN & LOGIKA)
       ========================================= */
    
    /* A lenyíló szekció konténere */
    #top-cat-section {
        width: 100%;
        max-width: var(--max-width);
        margin: -10px auto 20px auto;
        height: 0;
        overflow: hidden;
        opacity: 0;
        transition: height 0.5s ease, opacity 0.5s ease;
        background: var(--card-bg);
        border-radius: 12px;
        /* Alapból rejtve, border nélkül */
    }

    #top-cat-section.open {
        height: auto; /* JS fogja számolni, vagy auto */
        opacity: 1;
        padding: 20px;
        border: 1px solid var(--card-border);
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        overflow: visible; /* Hogy a pipák kilóghassanak ha kell */
    }

    /* Rács elrendezés a kártyáknak */
    .cat-grid {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }

    /* LEVEL 2 konténer (alapból rejtve) */
    .cat-sub-level {
        display: none; /* JS kapcsolja flex-re */
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 25px;
        padding-top: 25px;
        border-top: 1px dashed var(--card-border);
        animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- KÁRTYA STÍLUS (ZIP alapján, Trinexus színekkel) --- */
    .cat-card {
        --bg-color: #fff;
        --accent-color: var(--accent); /* Türkiz */
        --text-color: #666;
        --card-size: 160px; /* Kicsit kompaktabb */
        --radius: 12px;
        --transition: 0.2s;
        
        position: relative;
        width: var(--card-size);
        height: var(--card-size);
        background: var(--bg-color);
        border-radius: var(--radius);
        cursor: pointer;
        user-select: none;
        perspective: 1000px;
        display: block; /* Label elem */
    }

    /* Input elrejtése */
    .cat-card__input {
        display: none;
    }

    /* Kártya test */
    .cat-card__body {
        width: 100%;
        height: 100%;
        border-radius: var(--radius);
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        transition: transform var(--transition), box-shadow var(--transition);
        background: var(--bg-color);
        border: 2px solid transparent; /* Keret helye */
    }

    .cat-card:active .cat-card__body {
        transform: scale(0.96);
    }

    /* Kép tároló + Clip Path effekt */
    .cat-card__cover {
        width: 100%;
        height: 75%; /* Kép aránya */
        position: relative;
        overflow: hidden;
    }

    .cat-card__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: grayscale(1); /* Alapból fekete-fehér */
        transition: filter 0.3s ease;
        
        /* A ZIP-ben lévő tördelt üveg effekt */
        clip-path: polygon(0% 0%, 100% 0%, 100% 90%, 67% 83%, 33% 90%, 0% 85%);
    }

    /* Szöveg rész */
    .cat-card__header {
        height: 25%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 0 10px;
    }

    .cat-card__title {
        font-size: 13px;
        font-weight: 700;
        color: #797979;
        margin: 0;
        line-height: 1.2;
    }

    /* CHECKBOX PIPA ANIMÁCIÓ */
    .cat-card__checkbox {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 24px;
        height: 24px;
        background: var(--accent-color);
        border: 2px solid #fff;
        border-radius: 50%;
        z-index: 2;
        opacity: 0;
        transform: scale(0);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .cat-card__checkbox svg {
        width: 12px;
        height: 12px;
        fill: none;
        stroke: #fff;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-dasharray: 16px;
        stroke-dashoffset: 16px;
        transition: stroke-dashoffset 0.3s ease 0.1s;
    }

    /* --- AKTÍV ÁLLAPOT (CHECKED) --- */
    .cat-card__input:checked + .cat-card__body {
        border-color: var(--accent-color); /* Színes keret */
        box-shadow: 0 0 15px rgba(51, 204, 190, 0.3);
    }

    .cat-card__input:checked + .cat-card__body .cat-card__image {
        filter: grayscale(0); /* Színes kép */
    }

    .cat-card__input:checked + .cat-card__body .cat-card__checkbox {
        opacity: 1;
        transform: scale(1);
    }

    .cat-card__input:checked + .cat-card__body .cat-card__checkbox svg {
        stroke-dashoffset: 0; /* Pipa rajzolása */
    }

    /* MOBILON kisebb kártyák */
    @media (max-width: 480px) {
        .cat-card { --card-size: 100px; }
        .cat-card__title { font-size: 11px; }
        .cat-grid, .cat-sub-level { gap: 10px; }
    }

    /* --- LEVEL 2 AKTÍV STÍLUS (Kiválasztott kártya) --- */
    .cat-card.active-sub .cat-card__body {
        border-color: var(--accent); /* Türkiz keret */
        box-shadow: 0 0 15px rgba(51, 204, 190, 0.4);
    }
    
    .cat-card.active-sub .cat-card__image {
        filter: grayscale(0); /* Színes kép */
    }

    /* Pipa megjelenítése az aktív alsó kártyán is */
    .cat-card.active-sub .cat-card__checkbox {
        opacity: 1;
        transform: scale(1);
    }
    
    .cat-card.active-sub .cat-card__checkbox svg {
        stroke-dashoffset: 0;
    }

    /* =========================================
   FLOATING WIDGET CSS START
   ========================================= */
   /* =========================================
   1. CSS VÁLTOZÓK ÉS TÉMÁK
   ========================================= */
:root {
    /* Nappali téma színek */
    --primary-color: #55b6b3; /* Trinexus türkiz */
    --primary-dark: #449390;  /* Hover szín */
    --text-dark: #333333;
    --text-light: #ffffff;
    --bg-modal: #ffffff;
    --border-color: #cccccc;
    --shadow-color: rgba(0, 0, 0, 0.2);
}

/* Esti téma felülírások */
body.dark-mode {
    --primary-color: #408a87;
    --primary-dark: #306866;
    --text-dark: #b5b1b1;
    --text-light: #ffffff;
    --bg-modal: #2a2a2a;
    --border-color: #555555;
    --shadow-color: rgba(0, 0, 0, 0.5);
    background-color: #121212; 
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background-color: #f4f4f4; 
    transition: background-color 0.3s ease;
}

/* =========================================
   2. LEBEGŐ GOMB (FAB) STÍLUSOK
   ========================================= */
.fab-container {
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  user-select: none;
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 1000;
}

/* --- FIX: Animáció ugrálás (villogás) megszüntetése --- */
/* Láthatatlan híd a gombok között */
.fab-container:hover::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 350px; 
    background: transparent;
    z-index: -1;
}

/* Hover animáció triggere */
.fab-container:hover {
  height: auto;
}

/* Az al-gombok eltolása hoverre */
.fab-container:hover .sub-button:nth-child(2) { transform: translateY(-90px); }
.fab-container:hover .sub-button:nth-child(3) { transform: translateY(-155px); }
.fab-container:hover .sub-button:nth-child(4) { transform: translateY(-220px); }

/* Fő gomb stílusa (84px) */
.fab-container .fab {
  position: relative;
  height: 84px; 
  width: 84px;
  background-color: var(--primary-color);
  border-radius: 50%;
  z-index: 2;
  box-shadow: 0 4px 8px var(--shadow-color);
  transition: background-color 0.3s ease;
}

/* A kis "sarok" a fő gomb alján */
.fab-container .fab::before {
  content: " ";
  position: absolute;
  bottom: 0;
  right: 0;
  height: 42px; 
  width: 42px;
  background-color: inherit;
  border-radius: 0 0 10px 0;
  z-index: -1;
}

.fab-container .fab .fab-content {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #ffffff;
  box-sizing: border-box;
}

.main-profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Al-gombok stílusa */
.fab-container .sub-button {
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  bottom: 17px; 
  right: 17px;
  height: 50px;
  width: 50px;
  background-color: var(--primary-color);
  border-radius: 50%;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  box-shadow: 0 3px 6px var(--shadow-color);
  cursor: pointer;
  z-index: 1;
}

.fab-container .sub-button:hover {
    background-color: var(--primary-dark);
}

.fab-container .sub-button .material-icons {
  color: var(--text-light);
  font-size: 24px;
}

/* =========================================
   3. MODÁLIS ABLAKOK ALAPBEÁLLÍTÁSAI
   ========================================= */
.modal-overlay {
    display: none; /* EZ VOLT A HIBA: Ez hiányozhatott, ezért látszott minden */
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    backdrop-filter: blur(3px);
}

.modal-overlay.active {
    display: flex; /* Csak akkor látszik, ha aktív */
    opacity: 1;
}

.modal-content {
    background-color: var(--bg-modal);
    color: var(--text-dark);
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    width: 90%;
    max-width: 400px; /* Alapértelmezett szélesség */
    transform: translateY(20px);
    transition: transform 0.3s ease;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-overlay.active .modal-content {
    transform: translateY(0);
}

.close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
    transition: color 0.2s;
    z-index: 10;
}
.close-btn:hover { color: var(--text-dark); }

/* =========================================
   4. ŰRLAP ÉS TELEFON MODÁLIS STÍLUSOK
   ========================================= */
.form-style h2 {
    color: var(--primary-color);
    margin-top: 0;
    text-align: center;
}

.form-group { margin-bottom: 15px; }

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    box-sizing: border-box;
    font-family: inherit;
    background-color: var(--bg-modal);
    color: var(--text-dark);
}

.form-group textarea { resize: vertical; }

.checkbox-group {
    display: flex;
    align-items: flex-start;
    font-size: 13px;
}

.checkbox-group input { width: auto; margin-right: 8px; margin-top: 3px; }
.checkbox-group a { color: var(--primary-color); text-decoration: none; }

.submit-btn {
    width: 100%;
    padding: 12px;
    background-color: var(--primary-color);
    color: var(--text-light);
    border: none;
    border-radius: 4px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.2s;
}
.submit-btn:hover { background-color: var(--primary-dark); }

/* =========================================
   5. TÉRKÉP MODÁLIS (Széles verzió)
   ========================================= */

/* Felülírjuk az alap modal stílust a térképnél */
.modal-content.map-style {
    padding: 0 !important;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-width: 600px; /* Megnövelt szélesség, hogy kiférjen a kártya */
}

/* Fejléc stílusok */
.modal-content.map-style h3 {
    margin: 20px 0 5px 25px;
    color: var(--primary-color);
}
.modal-content.map-style .map-address {
    margin: 0 0 15px 25px;
    font-size: 14px;
    color: var(--text-dark);
}
.modal-content.map-style .close-btn {
    top: 15px; right: 20px;
}

/* Térkép konténer */
.map-frame-container {
    width: 100%;
    height: 400px; /* Magasabb térkép */
    position: relative;
    /* Nincs overflow hidden vagy pozicionálás hack */
}

.map-frame-container iframe {
    width: 100% !important; 
    height: 100% !important;
    border: 0;
    display: block;
    /* Nincs eltolás, így látszani fog a bal oldali kártya is */
}
/* === ADATVÉDELMI MODÁLIS STÍLUS === */
.privacy-style {
    max-width: 600px;
    /* Szélesebb, hogy olvasható legyen */
}

.privacy-text {
    max-height: 300px;
    /* Ha ennél hosszabb a szöveg, görgethető lesz */
    overflow-y: auto;
    padding-right: 10px;
    /* Hely a görgetősávnak */
    border: 1px solid #eee;
    /* Kis keret a szövegnek */
    padding: 15px;
    border-radius: 4px;
    background: #f9f9f9;
}

/* Gördítősáv csinosítása (Webkit böngészőkben) */
.privacy-text::-webkit-scrollbar {
    width: 6px;
}

.privacy-text::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}

/* =========================================
       MOBIL WIDGET BEÁLLÍTÁSOK (Bal alsó sarok + Kisebb méret)
       ========================================= */
    @media (max-width: 480px) {
        .fab-container {
            right: auto;  /* Kivesszük a jobb oldalról */
            left: 15px;   /* Áttesszük a bal oldalra */
            bottom: 45px; /* Kicsit lejjebb vesszük */
            align-items: flex-start; /* Balra igazítjuk a gombokat */
        }

        /* 1. FŐ GOMB KICSINYÍTÉSE (84px -> 60px) */
        .fab-container .fab {
            width: 60px;
            height: 60px;
        }
        /* A sarok-effekt (letörés) igazítása */
        .fab-container .fab::before {
            width: 30px;
            height: 30px;
        }

        /* 2. KIS GOMBOK KICSINYÍTÉSE (50px -> 40px) */
        .fab-container .sub-button {
            width: 40px;
            height: 40px;
            right: auto; /* Jobb igazítás törlése */
            left: 10px;  /* Középre igazítás a 60px-es főgombhoz képest (60-40)/2 */
            bottom: 10px;
        }
        
        /* Ikonok méretének csökkentése */
        .fab-container .sub-button .material-icons {
            font-size: 20px;
        }

        /* 3. ANIMÁCIÓK ÚJRASZÁMOLÁSA */
        /* Mivel kisebbek a gombok, közelebb kell ugraniuk egymáshoz */
        .fab-container:hover .sub-button:nth-child(2) { transform: translateY(-70px); }
        .fab-container:hover .sub-button:nth-child(3) { transform: translateY(-120px); }
        .fab-container:hover .sub-button:nth-child(4) { transform: translateY(-170px); }
        
        /* A "láthatatlan híd" magasságának csökkentése */
        .fab-container:hover::after {
            height: 220px;
        }
    }
  </style>
  
</head>

<body>

  <header class="site-header">
    <a href="https://www.trinexus.hu" target="_blank" class="logo-link" aria-label="Trinexus főoldal">
      <img src="logo2.png" alt="Trinexus Aqua" class="logo">
    </a>
    <div class="header-wrap">
      <div class="text">
        <span class="brand-main">Trinexus Aqua</span>
        <span class="brand-sub">termékkereső</span>
      </div>
      <form class="switcher">
        <fieldset class="switcher__legend">Theme Switcher</fieldset>
        <label class="switcher__option">
          <input type="radio" class="switcher__input" name="theme" value="light" c-option="1" checked>
          <div class="switcher__icon">
            <svg viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="12"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </div>
        </label>
        <label class="switcher__option">
          <input type="radio" class="switcher__input" name="theme" value="dark" c-option="2">
          <div class="switcher__icon">
            <svg viewBox="0 0 24 24">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </div>
        </label>
        <span class="switcher__filter"></span>
      </form>
    </div>
  </header>

  <div id="fav-trigger" onclick="toggleSidebar()">
    <span class="label-text">Kedvencek</span>
    <svg class="mobile-star" viewBox="0 0 24 24">
      <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
    </svg>
    <div id="fav-count">0</div>
  </div>

  <div id="cat-trigger" onclick="window.location.href='kepes_kereso_site.html'">
    <span class="label-text">Kategóriakereső</span>
    <svg class="mobile-star" viewBox="0 0 24 24">
      <path d="M10 3H3v7h7V3zm11 0h-7v7h7V3zm0 11h-7v7h7v-7zm-11 0H3v7h7v-7z" />
    </svg>
  </div>

  <aside id="fav-sidebar">
    <button class="close-sidebar-abs" onclick="toggleSidebar()">&times;</button>
    <div class="sidebar-tabs">
      <div class="sidebar-tab active" onclick="switchTab('fav')">Kedvencek</div>
      <div class="sidebar-tab" onclick="switchTab('history')">Előzmények</div>
    </div>
    <div class="sidebar-content-wrapper">
      <div id="fav-pane" class="sidebar-pane active">
        <div style="font-size:16px; font-weight:700; margin-bottom:10px; display:flex; align-items:center; gap:8px;">
          <span style="color:#FFD700;">★</span> Kedvenc termékek
        </div>
        <div id="fav-list"></div>
        <div class="sidebar-footer" style="background:none; border:none; padding:0; margin-top:20px;">
          <button class="sidebar-btn" onclick="openAllFavorites()">Összes megnyitása</button>
          <button class="sidebar-btn clear-btn" onclick="clearFavorites()">Lista törlése</button>
        </div>
      </div>
      <div id="history-pane" class="sidebar-pane">
        <div class="history-section-title">Legutóbbi keresések</div>
        <div id="history-queries"></div>
        <div class="history-section-title" style="margin-top:25px;">Legutóbb megtekintett</div>
        <div id="history-products"></div>
        <div style="margin-top:20px; text-align:center;">
          <button class="clear-btn" style="border:none;" onclick="clearHistory()">Előzmények törlése</button>
        </div>
      </div>
    </div>
  </aside>

  <div class="container">

    <div class="search-row">
      <div class="search-wrapper-combined" id="searchWrapper">
    
        <div class="cat-menu-trigger" id="catMenuBtn">
          Kategóriák
        </div>
        
        <div class="cat-menu-trigger current-menu-trigger" id="topCatBtn" onclick="toggleTopCategories()">
          Top kategóriák
        </div>
        <div class="cat-menu-trigger current-menu-trigger" id="currentBtn" onclick="toggleGallery()">
          Aktuális
        </div>
    
        <input id="q" class="search" type="search" placeholder="Írja be a termék nevét vagy cikkszámát..."
          autocomplete="off" style="border:none; border-radius:0 12px 12px 0; padding:12px;">
    
        <div class="mm-container">
          <ul class="mm-root" id="megaMenuRoot">
          </ul>
        </div>
      </div>
    </div>

    <section id="gallery-section" class="gallery-hidden">
      <div class="gallery-gradient-bar"></div>
      <div class="gallery-items" id="galleryItems">
        <div class="gallery-item" data-url="https://friedrich25la.github.io/haswing-landing/#top" style="background-image: url('https://www.fishing.net.nz/sites/default/cache/file/018586C8-D149-FF63-B79FC9FA546E4579.jpg');">
            <span class="gallery-label">Haswing motorok és alkatrészek</span>
        </div>
        <div class="gallery-item" data-url="https://friedrich25la.github.io/rib-hajok/?source_cat=121689" style="background-image: url('https://pehn-boats.com/wp-content/uploads/Schlauchboot_MyRIB_03.jpg');">
             <span class="gallery-label">Rib-hajók</span>
        </div>
        <div class="gallery-item" data-url="https://www.trinexus.hu/nyeremenyjatek" style="background-image: url('https://www.horgasz-zona.hu/termek_kepek/normal/Deeper-Smart-Sonar-Chirp--20-halradar-halradarok-kiegeszitok-11.jpg');">
             <span class="gallery-label">Deeper nyereményjáték</span>
        </div>
        <div class="gallery-item" data-url="https://www.trinexus.hu/csonak-kajak-kenu-latrex" style="background-image: url('https://latrex.lv/image/cache/catalog/latrex-490/222-1140x400.jpg');">
             <span class="gallery-label">Latrex csónakok</span>
        </div>
        <div class="gallery-item" data-url="https://www.trinexus.hu" style="background-image: url('https://minnkota.johnsonoutdoors.com/sites/default/files/styles/1534x/public/2023-06/C025-Tabs_3_FindFish_1280x720.png.webp');">
             <span class="gallery-label">Ajándék mellény</span>
        </div>
      </div>
    </section>

    <div id="top-cat-section">
    
      <div class="cat-grid">
    
        <label class="cat-card">
          <input type="checkbox" class="cat-card__input" name="top_level_1"
            onchange="handleTopCatChange(this, 'sub-motorok')">
          <div class="cat-card__body">
            <div class="cat-card__cover">
              <img class="cat-card__image" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS7fudEgeint3iPRj33gV5R1xC6g7q_DzbnMA&s" alt="Motorok">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Elektromos motorok</h3>
            </div>
          </div>
        </label>
    
        <label class="cat-card">
          <input type="checkbox" class="cat-card__input" name="top_level_1" onchange="handleTopCatChange(this, 'sub-akku')">
          <div class="cat-card__body">
            <div class="cat-card__cover">
              <img class="cat-card__image" src="https://www.trinexus.hu/img/17496/2104-00_altpic_3/2104-00.webp?time=1689996307" alt="Akkumulátorok">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Akkumulátorok</h3>
            </div>
          </div>
        </label>
    
        <label class="cat-card">
          <input type="checkbox" class="cat-card__input" name="top_level_1"
            onchange="handleTopCatChange(this, 'sub-csonak')">
          <div class="cat-card__body">
            <div class="cat-card__cover">
              <img class="cat-card__image" src="https://www.trinexus.hu/img/17496/842470_altpic_1/842470.webp?time=1681499437" alt="Csónakok">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Csónakok</h3>
            </div>
          </div>
        </label>
    
      </div>
    
      <div id="sub-motorok" class="cat-sub-level">
        <label class="cat-card" onclick="filterByCategories(this, 'Elektromos csónakmotor', 'Armada, Ultima, Ventura, Torqeedo Travel, Torqeedo Cruise, Torqeedo Deep Blue, Navy Evo, Spirit 1.0, X-széria, X-Series, Leisure, Mercury Avator')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://www.torqeedo.com/on/demandware.static/-/Sites-torqeedo-master/default/dwd69738d1/torqeedo/outboards/deep-blue/deep-blue-80-r/1/torqeedo-deep-blue-80-r-2000x2000.jpg"
                alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Külmotorok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card" onclick="filterByCategories(this, 'Belmotor', 'SKU:901431, 090423, 090424')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://tbnation.net/cdn/shop/products/epropulsion-i-series-electric-inboard-motor-i-20-20-kw-watercraft-engines-motors-1-tiny-boat-nation.jpg?v=1741942095"
                alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Belmotorok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card"
          onclick="filterByCategories(this, 'Pod', 'SKU:1268-00, 1269-00, 1283-00, 901485, 901482, 901483, 901484, 090428, 090429, 090430')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://static.b24.co/thumbs/xxlarge/607155-1724301467.jpg" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Pod-motorok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card" onclick="filterByCategories(this, 'Motor', 'Osapian, Protruar, Endura C 2 sorozat, Endura Max sorozat, Traxxis sorozat, Zebco, Dawn Marine')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://www.trinexus.hu/img/17496/50765-80-BY/1000x1000/50765-80-BY.webp?time=1739367369" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Trolling motorok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card" onclick="filterByCategories(this, 'Elektromos csónakmotor', 'Cayman, Powerdrive sorozat, Terrova sorozat, Ulterra sorozat, Ultrex sorozat')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://www.trinexus.hu/img/17496/903010_altpic_1/903010.webp?time=1700057131" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Orrmotorok</h3>
            </div>
          </div>
        </label>
      </div>
    
      <div id="sub-akku" class="cat-sub-level">
        <label class="cat-card" onclick="filterByCategories(this, 'Lítium', 'Lítium, LiFePO4')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image" src="https://www.trinexus.hu/img/17496/901259/901259.webp"
                alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Lítium</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card" onclick="filterByCategories(this, 'Akkumulátor, töltő, kapcsoló, doboz, egyebek', 'ZAP, Rocket, Banner, Effekta, Indító akkumulátor, Törpe akkumulátor')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://www.trinexus.hu/img/17496/95607/500x500/95607.webp?time=1689956900" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Ólom-sav</h3>
            </div>
          </div>
        </label>
      </div>
    
      <div id="sub-csonak" class="cat-sub-level">
        <label class="cat-card" onclick="filterByCategories(this, 'Gumicsónak', 'Dawn Marine Farfalla, Kolibri, Honda, Allroundmarin')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://www.trinexus.hu/img/17496/842300/842300.webp" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Gumicsónakok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card" onclick="filterByCategories(this, 'Műanyag csónakok', 'BIC csónakok, Whaly, Latrex, Aquajoy')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image"
                src="https://m.media-amazon.com/images/I/71odr0CgBvL._AC_UF350,350_QL80_.jpg" alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Műanyag csónakok</h3>
            </div>
          </div>
        </label>
      
        <label class="cat-card"
          onclick="filterByCategories(this, 'Alumínium', 'SKU:A470B, A420B, A420BV, A350K, A310GB, 099100, 099100SZ, 099102')">
          <div class="cat-card__body">
            <div class="cat-card__cover"><img class="cat-card__image" src="https://www.trinexus.hu/img/17496/A420B/A420B.webp"
                alt="">
              <div class="cat-card__checkbox"><svg viewBox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </svg></div>
            </div>
            <div class="cat-card__header">
              <h3 class="cat-card__title">Alumínium csónakok</h3>
            </div>
          </div>
        </label>
      </div>
    
    </div>
    
    <script src="menu.js"></script>

    <div class="controls-row">
      <div id="slider-wrapper">
        <span id="price-min" class="price-label">0 Ft</span>
        <div id="slider"></div>
        <span id="price-max" class="price-label">0 Ft</span>
      </div>

      <div class="field menu" id="category-menu-container">
        <div class="control">
          <button id="category-toggle" aria-haspopup="true" aria-expanded="false">Kategória: Összes</button>
          <menu id="category-menu" role="listbox">
          </menu>
        </div>
      </div>

      <div class="field menu" id="sort-menu-container">
        <div class="control">
          <button id="sharing-toggle" aria-haspopup="true" aria-expanded="false">Rendezés: Relevancia</button>
          <menu id="sharing-menu" role="listbox">
            <li data-option="relevance" role="option" tabindex="0" class="selected">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                </polygon>
              </svg>
              <h3>Relevancia</h3>
            </li>
            <li data-option="price_asc" role="option" tabindex="0">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <line x1="12" y1="19" x2="12" y2="5"></line>
                <polyline points="5 12 12 5 19 12"></polyline>
              </svg>
              <h3>Ár: növekvő</h3>
            </li>
            <li data-option="price_desc" role="option" tabindex="0">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
              </svg>
              <h3>Ár: csökkenő</h3>
            </li>
            <li data-option="name_asc" role="option" tabindex="0">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M15 10l5 5 5-5" />
                <path d="M4 6h16" />
              </svg>
              <h3>Név A→Z</h3>
            </li>
            <li data-option="name_desc" role="option" tabindex="0">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M15 14l5-5 5 5" />
                <path d="M4 18h16" />
              </svg>
              <h3>Név Z→A</h3>
            </li>
          </menu>
        </div>
        <select id="sortSelect" hidden>
          <option value="relevance" selected>Relevancia</option>
          <option value="price_asc">Ár: növekvő</option>
          <option value="price_desc">Ár: csökkenő</option>
          <option value="name_asc">Név A→Z</option>
          <option value="name_desc">Név Z→A</option>
        </select>
      </div>

      <div class="checkbox-column">
        <div>
          <input type="checkbox" id="descSearch">
          <label for="descSearch">keresés leírásban is</label>
        </div>
      
        <div>
          <input type="checkbox" id="imgOnly">
          <label for="imgOnly">csak képpel</label>
        </div>
      </div>
    </div>

    <div class="amz-grid-container">
      <div class="amz-card">
        <div class="amz-header">Ajándékötletek</div>
        <div class="amz-grid-inner">
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Ajandekutalvany" target="_blank">
              <img src="https://mrgbeats.com/wp-content/uploads/2020/12/New-Project-1.png" alt="Kikötés">
            </a>
            <span>Ajándékutalvány</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/ajandektargy-butor-disztargy" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/RDH-0826/286x286,r/RDH-0826.webp?time=1733234164" alt="Horgony">
            </a>
            <span>Dísztárgyak</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/ajandektargy-hajosmodell" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/R124108/R124108.webp" alt="Kötél">
            </a>
            <span>Hajómakettek</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Etkeszlet-tanyer-pohar" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/4857/543x543,r/4857.webp?time=1689970093" alt="Fender">
            </a>
            <span>Étkészletek</span>
          </div>
        </div>
        <a href="https://www.trinexus.hu/ajandektargy" class="amz-footer" target="_blank">További ajándéktárgyak</a>
      </div>
    
      <div class="amz-card">
        <div class="amz-header">Csónakok</div>
        <div class="amz-grid-inner">
          <div class="amz-item">
            <a href="https://aquamarine-cactus-d0f609.netlify.app/?q=gumicsonak&minprice=299900&maxprice=499900"
              target="_blank">
              <img src="https://www.trinexus.hu/img/17496/842270/515x515,r/842270.webp?time=1681499434" alt="Fánk">
            </a>
            <span>Gumicsónakok 500.000,- alatt</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Caytan-aluminium-csonakok" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/A420B/572x572,r/A420B.webp?time=1719663001" alt="Mellény">
            </a>
            <span>Caytan alu csónakok</span>
          </div>
          <div class="amz-item">
            <a href="https://aquamarine-cactus-d0f609.netlify.app/?q=latrex&minprice=400000&maxprice=1000000"
              target="_blank">
              <img src="https://www.trinexus.hu/img/17496/000700/572x572,r/000700.webp?time=1682356094" alt="Wakeboard">
            </a>
            <span>Latrex csónakok 1.000.000,- alatt</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/csonak-cadrava-aluminium-csonakok" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/099100_altpic_1/099100.webp?time=1742934441" alt="SUP">
            </a>
            <span>Cadrava alu csónakok</span>
          </div>
        </div>
        <a href="https://www.trinexus.hu/Vizi_sport" class="amz-footer" target="_blank">Összes csónak</a>
      </div>
    
      <div class="amz-card">
        <div class="amz-header">Jó vételek</div>
        <div class="amz-grid-inner">
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Haswing-Osapian-55" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/50703_altpic_1/500x500/50703.webp?time=1739191463" alt="Radar">
            </a>
            <span>Osapian 55</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Deeper-Chirp-2-Trophy-Bundle" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/013548/486x486,r/013548.webp?time=1735904162" alt="GPS">
            </a>
            <span>Deeper CHIRP+2 okos szonár</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Garmin-Striker-Plus-9sv-Worldwide-w-GT52" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/GG010-02554-01/500x500/GG010-02554-01.webp?time=1743516669"
                alt="Audio">
            </a>
            <span>Garmin Striker Vivid 9 SV</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Humminbird-Xplore-9-CMSI" target="_blank">
              <img src="https://centrumzoo.hu/img/7097/596884/500x500/596884.webp?time=1732292994" alt="Műszer">
            </a>
            <span>Humminbird Xplore 9</span>
          </div>
        </div>
        <a href="https://www.trinexus.hu/akcios-termekek" class="amz-footer" target="_blank">További akciós termékek</a>
      </div>
    
      <div class="amz-card">
        <div class="amz-header">Haswing motorok</div>
        <div class="amz-grid-inner">
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Haswing-Osapian-30" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/50701-80E/500x500/50701-80E.webp?time=1748619926" alt="Festék">
            </a>
            <span>Osapian 30</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Haswing-Cayman-B55-Helmsman-GPS-12V-Gen-1-6" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/50736-137-W/1000x1000/50736-137-W.webp?time=1756236799"
                alt="Tisztító">
            </a>
            <span>Haswing Cayman B55 Helmsman GPS</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/Haswing-Protruar-1-0-65-lbs" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/50744/50744.webp?time=1756236391" alt="Olaj">
            </a>
            <span>Protruar 1.0</span>
          </div>
          <div class="amz-item">
            <a href="https://www.trinexus.hu/spd/50719-100/Haswing-Protruar-5-0-160-lbs-24V" target="_blank">
              <img src="https://www.trinexus.hu/img/17496/50719-100_altpic_2/50719-100.webp?time=1715699581"
                alt="Alkatrész">
            </a>
            <span>Protruar 5.0</span>
          </div>
        </div>
        <a href="https://www.trinexus.hu/elektromos-csonakmotor-haswing" class="amz-footer" target="_blank">További Haswing
          motorok</a>
      </div>
    </div>

    <div id="results-count" class="results-meta" style="display:none;"></div>
    <div id="results" class="results">
      <div class="loading"></div>
    </div>
    <div id="debug" class="debug" style="display:none"></div>
  </div>

  <footer style="font-size:13px;color:#666;padding:16px;text-align:center">© 2025 MageSoft. Minden jog fenntartva.
  </footer>

  <div id="desc-modal-overlay" class="modal-overlay" onclick="closeDescModal()">
    <div id="desc-modal" class="desc-modal" onclick="event.stopPropagation()">
      <button class="close-modal-btn" onclick="closeDescModal()">&times;</button>

      <h3 id="desc-modal-title">Termék neve</h3>

      <div class="modal-info-row">
          <img id="modal-img" class="mini-thumb" src="" alt="">
        
          <div id="modal-price" class="modal-price"></div>
        
          <div class="shipping-block">
            <span class="shipping-label">Házhozszállítás:</span>
            <div class="shipping-icons">
              <img src="gls.png" alt="GLS" class="shipping-icon">
              <img src="mpl.png" alt="MPL" class="shipping-icon">
            </div>
          </div>
      </div>

      <div class="modal-meta-row">
        <span id="modal-warranty" class="warranty-badge"></span>
        <span id="modal-sales" class="sales-text"></span>
      </div>

      <div class="desc-scroll-container">
        <div class="desc-content" id="desc-modal-content">
        </div>
        <div class="scrollbar-track">
          <div class="scrollbar-thumb"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="modal-fav-btn" class="modal-action-btn" title="Kedvencekhez adás">
        </button>
        <a id="modal-link-btn" class="modal-action-btn" href="#" target="_blank" title="Termékoldal megnyitása">
          <svg viewBox="0 0 24 24">
            <path
              d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
          </svg>
        </a>
      </div>
    </div>
  </div>

  <div class="fab-container">
        <div class="fab shadow">
            <div class="fab-content">
                 <img src="11zon_cropped.png" alt="Kapcsolat" class="main-profile-img">
            </div>
        </div>

        <div class="sub-button shadow" onclick="openModal('mapModal')" title="Térkép">
            <span class="material-icons">place</span>
        </div>
        <div class="sub-button shadow" onclick="openModal('formModal')" title="Üzenet küldése">
            <span class="material-icons">mail_outline</span>
        </div>
        <div class="sub-button shadow" id="phoneBtn" title="Telefonhívás">
            <span class="material-icons">phone</span>
        </div>
    </div>


    <div id="formModal" class="modal-overlay" onclick="closeModalIfOutside(event, 'formModal')">
        <div class="modal-content form-style">
            <span class="close-btn" onclick="closeModal('formModal')">×</span>
            <h2>Kérdésed van?</h2>
            
            <form id="contactForm">
                <div class="form-group">
                    <label for="salutation">Megszólítás</label>
                    <select id="salutation" name="salutation">
                        <option value="">Válassz kérlek...</option>
                        <option value="ur">Úr</option>
                        <option value="holgy">Hölgy</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="name">Név*</label>
                    <input type="text" id="name" name="name" placeholder="Ide írhatod ..." required>
                </div>
                
                <div class="form-group">
                    <label for="email">E-mail*</label>
                    <input type="email" id="email" name="email" placeholder="Ide írhatod ..." required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Telefon</label>
                    <input type="tel" id="phone" name="phone" placeholder="Ide írhatod ...">
                </div>
                
                <div class="form-group">
                    <label for="message">Üzenet*</label>
                    <textarea id="message" name="message" rows="4" placeholder="Ide írhatod ..." required></textarea>
                </div>
                
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="privacy" name="privacy" required>
                    <label for="privacy">Elolvastam és elfogadom az <a href="#" onclick="openModal('privacyModal'); return false;">Adatvédelmi irányelveket</a>.</label>
                </div>
                
                <button type="submit" class="submit-btn">
                    <span class="material-icons" style="font-size: 18px; margin-right: 8px; rotate: -45deg;">send</span>
                    Küldés
                </button>
            </form>
        </div>
    </div>


    <div id="mapModal" class="modal-overlay" onclick="closeModalIfOutside(event, 'mapModal')">
        <div class="modal-content map-style">
            <span class="close-btn" onclick="closeModal('mapModal')">×</span>
            <h3>Itt találsz meg minket:</h3>
            <p class="map-address">1107 Budapest, Mázsa tér 5-7.</p>
            <div class="map-frame-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2696.4836234656677!2d19.1268171927514!3d47.480491241846586!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4741dd122aef989d%3A0xe1467e49a370412a!2sTrinexus%20Aqua%20Haj%C3%B3sbolt%20Budapest!5e0!3m2!1shu!2shu!4v1764944343011!5m2!1shu!2shu" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>
    </div>


    <div id="phoneModal" class="modal-overlay" onclick="closeModalIfOutside(event, 'phoneModal')">
        <div class="modal-content phone-style" style="text-align: center;">
            <span class="close-btn" onclick="closeModal('phoneModal')">×</span>
            <h2 style="color: var(--primary-color); margin-top: 0;">Hívj minket bizalommal!</h2>
            
            <p style="font-size: 16px; margin-bottom: 20px;">Ügyfélszolgálatunk elérhetősége:</p>
            
            <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <a href="tel:+36702505740" style="font-size: 24px; font-weight: bold; color: var(--text-dark); text-decoration: none; display: block;">
                    +36 1 234 56789
                </a>
            </div>

            <p style="font-size: 13px; color: #888;">
                Mobilon kattintva azonnal hívható. <br>
                Nyitvatartás: H-P 9:00 - 17:00
            </p>

            <button onclick="window.location.href='tel:+36123456789'" class="submit-btn" style="margin-top: 10px;">
                <span class="material-icons" style="margin-right: 8px;">call</span>
                Hívás indítása
            </button>
        </div>
    </div>


    <div id="privacyModal" class="modal-overlay" onclick="closeModalIfOutside(event, 'privacyModal')">
        <div class="modal-content privacy-style">
            <span class="close-btn" onclick="closeModal('privacyModal')">×</span>
            <h2 style="color: var(--primary-color); margin-top: 0;">Adatkezelési Tájékoztató</h2>
            
            <div class="privacy-text" style="text-align: left; line-height: 1.5; font-size: 14px; color: #555;">
                <p><strong>1. Az adatkezelő adatai</strong><br>
                Cégnév: <strong>[BEOCIA KFT.]</strong><br>
                Székhely: [1107 Bp., Mázsa tér 5-7.]<br>
                E-mail: [info@trinexus.hu]</p>

                <p><strong>2. Az adatkezelés célja és jogalapja</strong><br>
                A weboldalon található kapcsolatfelvételi űrlap kitöltésével Ön hozzájárul ahhoz, hogy megadott adatait (név, e-mail cím, telefonszám) kapcsolatfelvétel céljából kezeljük. A jogalap az Ön önkéntes hozzájárulása (GDPR 6. cikk (1) a) pont).</p>

                <p><strong>3. Adatfeldolgozók (Technikai háttér)</strong><br>
                Az űrlap technikai működtetéséhez külső szolgáltatót veszünk igénybe:<br>
                <em>Formspree Inc.</em> (USA). A Formspree megfelel a nemzetközi adatvédelmi normáknak. Az adatok továbbítása a válaszadás érdekében történik.</p>

                <p><strong>4. Az adatok megőrzési ideje</strong><br>
                Az adatokat az ügy elintézéséig, vagy az Ön törlési kérelméig tároljuk. Ön bármikor kérheti adatai törlését a fenti e-mail címen.</p>
            </div>

            <button onclick="closeModal('privacyModal')" class="submit-btn" style="margin-top: 20px;">
                Bezárás
            </button>
        </div>
    </div>
    ```


  <script type="module">
    import RangeSlider from "https://esm.sh/svelte-range-slider-pips";
    window.RangeSlider = RangeSlider; 
  </script>

  <script>
    /* ---------- GLOBALS & STATE ---------- */
    const MIN_TOKEN_LEN = 3;
    let favorites = [];
    let searchHistory = [];
    let viewHistory = [];
    let productsPool = [];
    let priceRange = { min: 0, max: 100000, currentMin: 0, currentMax: 0 };
    let sliderInstance = null;
    let currentState = { query: '', page: 1, isLoading: false, hasMore: true, categoryFilter: null, isCategorySearch: false };
    let isFirstLoad = true;

    /* ---------- SEGÉDFÜGGVÉNY: URL OLVASÁS ---------- */
    function getUrlParams() {
      let params = new URLSearchParams(window.location.search);
      try {
        if (window.parent !== window) {
          const parentParams = new URLSearchParams(window.parent.location.search);
          if (parentParams.has('q') || parentParams.has('minprice') || parentParams.has('maxprice')) {
            params = parentParams;
          }
        }
      } catch (e) { }
      return params;
    }

    /* ---------- JAVÍTOTT ÁR KALKULÁTOR (Üres dátumok kezelése) ---------- */
    function getPriceData(product) {
      // 1. Alapár (A JSON-ban már bruttó van)
      let currentPrice = parseFloat(product.price || 0);
      let originalPrice = currentPrice;
      let isSale = false;

      // 2. Akciós ár vizsgálata
      let salePrice = parseFloat(product.sale_price || 0);

      // Csak akkor foglalkozunk az akcióval, ha létezik az ár, nagyobb mint 0, és alacsonyabb az eredetinél
      if (salePrice > 0 && salePrice < originalPrice) {
        
        const now = new Date();
        now.setHours(0, 0, 0, 0); // Ma éjfél

        // Dátumok biztonságos beolvasása (az üres stringet null-nak vesszük)
        let startStr = product.sale_start;
        let endStr = product.sale_end;

        let start = (startStr && startStr.trim() !== "") ? new Date(startStr) : null;
        let end = (endStr && endStr.trim() !== "") ? new Date(endStr) : null;
        
        // Ellenőrizzük, hogy a dátumok érvényesek-e (Invalid Date kiszűrése)
        if (start && isNaN(start.getTime())) start = null;
        if (end && isNaN(end.getTime())) end = null;

        let isActive = false;

        // LOGIKA:
        // 1. Ha van LEJÁRAT, azt mindenképp ellenőrizzük.
        if (end) {
            let endCheck = new Date(end);
            endCheck.setHours(23, 59, 59, 999); // A nap vége

            // Ha már lejárt, akkor biztosan nem aktív
            if (now > endCheck) {
                isActive = false;
            } else {
                // Még nem járt le. Nézzük a kezdetet.
                if (start) {
                    // Van kezdet is: akkor aktív, ha a ma a kezdet után van
                    let startCheck = new Date(start);
                    startCheck.setHours(0, 0, 0, 0);
                    if (now >= startCheck) isActive = true;
                } else {
                    // Nincs kezdet, csak jövőbeli lejárat -> AKTÍV
                    isActive = true;
                }
            }
        } 
        // 2. Ha NINCS lejárat, de van KEZDET
        else if (start) {
             let startCheck = new Date(start);
             startCheck.setHours(0, 0, 0, 0);
             if (now >= startCheck) isActive = true;
        }
        // 3. Ha se kezdet, se lejárat, de van akciós ár -> AKTÍV (Opcionális: kiveheted, ha nem akarod)
        // A te kérésed alapján: "ha a lejárat dátuma még nem jött el" -> ez feltételezi, hogy lennie kell lejáratnak?
        // Ha szigorúan vesszük, hogy csak dátummal érvényes:
        // else { isActive = false; } 
        
        if (isActive) {
          currentPrice = salePrice;
          isSale = true;
        }
      }

      return {
        price: currentPrice,
        originalPrice: originalPrice,
        isSale: isSale
      };
    }

    function updateBrowserHistory(query, min, max) {
      if (!query) return;

      const url = new URL(window.location);
      url.searchParams.set('q', query);

      if (min > 0) url.searchParams.set('minprice', min);
      else url.searchParams.delete('minprice');

      if (max > 0) url.searchParams.set('maxprice', max);
      else url.searchParams.delete('maxprice');

      window.history.pushState({ q: query, min: min, max: max }, '', url);
    }

    window.addEventListener('popstate', (event) => {
      const params = getUrlParams();
      const q = params.get('q');

      if (q) {
        document.getElementById('q').value = q;
        renderForQuery(q, true, true);
      } else {
        location.reload();
      }
    });

    function getLeafCategory(rawCategory) {
      if (!rawCategory) return "Egyéb";
      if (Array.isArray(rawCategory)) {
        if (rawCategory.length === 0) return "Egyéb";
        return rawCategory[rawCategory.length - 1];
      }
      if (typeof rawCategory === 'string') {
        const parts = rawCategory.split('|');
        const cleanParts = parts.filter(p => p && p.trim().length > 0);
        if (cleanParts.length === 0) return "Egyéb";
        return cleanParts[cleanParts.length - 1].trim();
      }
      return "Egyéb";
    }

    /* ---------- SWITCHER ---------- */
    const switcher = document.querySelector('.switcher');
    if (switcher) {
      const radios = switcher.querySelectorAll('input[type="radio"]');
      const savedTheme = localStorage.getItem('theme_preference');
      if (savedTheme) {
        const rad = switcher.querySelector(`input[value="${savedTheme}"]`);
        if (rad) rad.checked = true;
      }
      radios.forEach(radio => {
        radio.addEventListener('change', () => {
          if (radio.checked) localStorage.setItem('theme_preference', radio.value);
        });
      });
    }

    /* ---------- DATA HANDLING ---------- */
    try {
      const favStored = localStorage.getItem('trinexus_favorites');
      if (favStored) favorites = JSON.parse(favStored);
      const qStored = localStorage.getItem('trinexus_search_history');
      if (qStored) searchHistory = JSON.parse(qStored);
      const vStored = localStorage.getItem('trinexus_view_history');
      if (vStored) viewHistory = JSON.parse(vStored);
      document.addEventListener('DOMContentLoaded', updateSidebarUI);
    } catch (e) { console.error('LS Error', e); }

    function saveFavorites() { localStorage.setItem('trinexus_favorites', JSON.stringify(favorites)); }
    function saveHistory() {
      localStorage.setItem('trinexus_search_history', JSON.stringify(searchHistory));
      localStorage.setItem('trinexus_view_history', JSON.stringify(viewHistory));
    }
    function addToSearchHistory(q) {
      if (!q) return; q = q.trim();
      searchHistory = searchHistory.filter(item => item !== q);
      searchHistory.unshift(q); if (searchHistory.length > 5) searchHistory.pop();
      saveHistory(); updateHistoryUI();
    }
    function addToViewHistory(product) {
      viewHistory = viewHistory.filter(item => item.sku !== product.sku);
      viewHistory.unshift(product); if (viewHistory.length > 10) viewHistory.pop();
      saveHistory(); updateHistoryUI();
    }

    /* ---------- UI ACTIONS ---------- */
    function toggleSidebar() { document.getElementById('fav-sidebar').classList.toggle('open'); document.body.classList.toggle('sidebar-open'); }
    window.switchTab = function (tabName) {
      document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.sidebar-pane').forEach(p => p.classList.remove('active'));
      if (tabName === 'fav') {
        document.querySelector('.sidebar-tab:nth-child(1)').classList.add('active');
        document.getElementById('fav-pane').classList.add('active');
      } else {
        document.querySelector('.sidebar-tab:nth-child(2)').classList.add('active');
        document.getElementById('history-pane').classList.add('active');
        updateHistoryUI();
      }
    };
    document.addEventListener('click', function (e) {
      const sb = document.getElementById('fav-sidebar'); const trig = document.getElementById('fav-trigger');
      if (sb.classList.contains('open') && !sb.contains(e.target) && !trig.contains(e.target)) toggleSidebar();
    });

    function isFavorite(sku) { return favorites.some(f => f.sku === sku); }
    function toggleFavorite(product, btnElement, imgElement) {
      const idx = favorites.findIndex(f => f.sku === product.sku);
      if (idx > -1) {
        favorites.splice(idx, 1); btnElement.classList.remove('active'); btnElement.innerHTML = getStarIcon(false);
      } else {
        favorites.push(product); btnElement.classList.add('active'); btnElement.innerHTML = getStarIcon(true);
        if (imgElement) runFlyAnimation(imgElement);
      }
      saveFavorites(); updateSidebarUI();

      // Ha a modal nyitva van, frissítjük annak a gombját is
      const modalFavBtn = document.getElementById('modal-fav-btn');
      if (modalFavBtn) {
        const isFav = isFavorite(product.sku);
        if (isFav) modalFavBtn.classList.add('active');
        else modalFavBtn.classList.remove('active');
        modalFavBtn.innerHTML = getStarIcon(isFav);
      }
      // Ha a listában vagyunk, frissítjük az összes kártyán lévő ikont is
      document.querySelectorAll(`.fav-icon[data-sku="${product.sku}"]`).forEach(el => {
        const isFav = isFavorite(product.sku);
        if (isFav) el.classList.add('active'); else el.classList.remove('active');
        el.innerHTML = getStarIcon(isFav);
      });
    }

    function getStarIcon(isActive) { return `<svg viewBox="0 0 24 24"><path fill="${isActive ? '#FFD700' : 'currentColor'}" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`; }

    function updateSidebarUI() {
      const listEl = document.getElementById('fav-list'); const countEl = document.getElementById('fav-count');
      if (listEl && countEl) {
        countEl.textContent = favorites.length; countEl.style.display = favorites.length > 0 ? 'flex' : 'none';
        if (favorites.length === 0) listEl.innerHTML = '<div style="text-align:center; color: var(--muted); margin-top:40px; font-size:13px;">Még nincs kedvenc terméked.<br>Kattints a <span style="color:#ccc; font-size:16px;">★</span> ikonra!</div>';
        else { listEl.innerHTML = ''; favorites.forEach(p => listEl.appendChild(createSideItem(p, true))); }
      }
      updateHistoryUI();
    }
    function updateHistoryUI() {
      const qEl = document.getElementById('history-queries');
      if (qEl) {
        if (searchHistory.length === 0) qEl.innerHTML = '<div style="font-size:13px; color:var(--muted); font-style:italic;">Nincs előzmény</div>';
        else {
          qEl.innerHTML = '';
          searchHistory.forEach(q => {
            const tag = document.createElement('span'); tag.className = 'history-tag'; tag.textContent = q;
            tag.onclick = () => { document.getElementById('q').value = q; renderForQuery(q, true); toggleSidebar(); };
            qEl.appendChild(tag);
          });
        }
      }
      const vEl = document.getElementById('history-products');
      if (vEl) {
        if (viewHistory.length === 0) vEl.innerHTML = '<div style="font-size:13px; color:var(--muted); font-style:italic;">Nincs megtekintett termék</div>';
        else { vEl.innerHTML = ''; viewHistory.forEach(p => vEl.appendChild(createSideItem(p, false))); }
      }
    }
    function createSideItem(p, isFavList) {
      const item = document.createElement('div'); item.className = 'fav-item';
      let imgSrc = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
      if (p.img) { const imgs = p.img.toString().split(/\||,|;|\n/).filter(Boolean); if (imgs.length) imgSrc = imgs[0].startsWith('http') ? imgs[0] : 'https://' + imgs[0]; }
      let html = `<a href="${p.url}" target="_blank" onclick="addToViewHistory({sku:'${p.sku}',name:'${p.name.replace(/'/g, "\\'")}',price:'${p.price}',img:'${p.img}',url:'${p.url}'})"><img src="${imgSrc}" alt=""></a><div class="fav-info"><div class="fav-name">${p.name}</div><div class="fav-price">${p.price ? Math.round(p.price).toLocaleString('hu-HU') + ' Ft' : ''}</div></div>`;
      if (isFavList) html += `<div class="remove-fav" onclick="removeFavBySku('${p.sku}')">×</div>`;
      item.innerHTML = html; return item;
    }
    window.clearFavorites = function () { if (confirm('Biztosan törölni szeretnéd a kedvenceket?')) { favorites = []; saveFavorites(); updateSidebarUI(); document.querySelectorAll('.card .fav-icon').forEach(b => { b.classList.remove('active'); b.innerHTML = getStarIcon(false) }); } };
    window.removeFavBySku = function (sku) { const idx = favorites.findIndex(f => f.sku === sku); if (idx > -1) { favorites.splice(idx, 1); saveFavorites(); updateSidebarUI(); } };
    window.openAllFavorites = function () { if (favorites.length && confirm(favorites.length + " termék megnyitása?")) [...favorites].reverse().forEach((p, i) => { if (p.url) setTimeout(() => window.open(p.url, '_blank'), i * 300); }); };
    window.clearHistory = function () { if (confirm('Törlöd az előzményeket?')) { searchHistory = []; viewHistory = []; saveHistory(); updateHistoryUI(); } };

    function runFlyAnimation(sourceImg) {
      const triggerBtn = document.getElementById('fav-trigger'); if (!triggerBtn) return;
      const targetRect = triggerBtn.getBoundingClientRect(); const startRect = sourceImg.getBoundingClientRect();
      const flyContainer = document.createElement('div'); flyContainer.className = 'fly-container';
      const flyInner = document.createElement('div'); flyInner.className = 'fly-inner';
      flyInner.appendChild(sourceImg.cloneNode()); flyContainer.appendChild(flyInner); document.body.appendChild(flyContainer);
      flyContainer.style.transform = `translate(${startRect.left}px, ${startRect.top}px)`;
      flyContainer.style.width = startRect.width + 'px'; flyContainer.style.height = startRect.height + 'px';
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          const destX = targetRect.left + (targetRect.width / 2) - 25; const destY = targetRect.top + (targetRect.height / 2) - 25;
          flyContainer.style.transform = `translate(${destX}px, ${startRect.top}px)`;
          flyContainer.style.width = '20px'; flyContainer.style.height = '20px'; flyContainer.style.opacity = '0.5';
          flyInner.style.transform = `translateY(${destY - startRect.top}px)`;
        });
      });
      setTimeout(() => { flyContainer.remove(); triggerBtn.style.transform = 'scale(1.2)'; setTimeout(() => triggerBtn.style.transform = 'scale(1)', 200); }, 800);
    }


    /* ---------- KATEGÓRIA DROPDOWN LOGIKA ---------- */
    function updateCategoryDropdown(products) {
      const menuList = document.getElementById('category-menu');
      const btn = document.getElementById('category-toggle');

      if (!menuList || !btn) return;

      menuList.innerHTML = '';
      const categories = {};

      if (products && products.length > 0) {
        products.forEach(p => {
          const leaf = getLeafCategory(p.category);
          if (leaf && leaf !== "Egyéb") {
            categories[leaf] = (categories[leaf] || 0) + 1;
          }
        });
      }

      const allLi = document.createElement('li');
      allLi.innerHTML = `<h3>Összes termék</h3>`;
      if (currentState.categoryFilter === null) {
        allLi.className = 'selected';
      }
      allLi.addEventListener('click', (e) => {
        e.stopPropagation();
        currentState.categoryFilter = null;
        btn.textContent = "Kategória: Összes";
        closeAllMenus();
        filterAndRender();
      });
      menuList.appendChild(allLi);

      const keys = Object.keys(categories);
      keys.sort().forEach(catName => {
        const li = document.createElement('li');
        li.innerHTML = `<h3>${catName} <small style="opacity:0.6">(${categories[catName]})</small></h3>`;

        if (currentState.categoryFilter === catName) {
          li.classList.add('selected');
        }

        li.addEventListener('click', (e) => {
          e.stopPropagation();
          currentState.categoryFilter = catName;
          btn.textContent = `Kategória: ${catName}`;
          closeAllMenus();
          filterAndRender();
        });
        menuList.appendChild(li);
      });
    }

    function closeAllMenus() {
      document.querySelectorAll('.field.menu').forEach(field => {
        field.classList.remove('open');
        const btn = field.querySelector('button');
        if (btn) btn.setAttribute('aria-expanded', false);
      });
    }

    /* ---------- ACTION MENU LOGIC ---------- */
    /* ---------- ACTION MENU LOGIC ---------- */
    (function initMenus() {
      const fields = document.querySelectorAll('.field.menu');

      fields.forEach(field => {
        const btn = field.querySelector('button');
        const menu = field.querySelector('menu');
        const options = menu.querySelectorAll('li');
        const select = field.querySelector('select');

        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const isOpen = field.classList.contains('open');
          closeAllMenus();
          if (!isOpen) {
            field.classList.add('open');
            btn.setAttribute('aria-expanded', true);
          }
        });

        if (select) {
          if (menu) {
            const items = menu.querySelectorAll('li');
            items.forEach(opt => {
              opt.addEventListener('click', (e) => {
                e.stopPropagation();
                const val = opt.dataset.option;
                select.value = val;
                
                // --- JAVÍTÁS: GOMB SZÖVEG FRISSÍTÉSE ---
                const labelText = opt.querySelector('h3').textContent;
                // Ha rendezés menü, akkor "Rendezés: ...", ha kategória, akkor "Kategória: ..."
                if(btn.id === 'sharing-toggle') {
                    btn.textContent = "Rendezés: " + labelText;
                } else {
                    btn.textContent = labelText; // Kategóriánál (elvileg ezt a másik függvény kezeli, de nem árt)
                }
                // ----------------------------------------

                items.forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                closeAllMenus();
                filterAndRender();
              });
            });
          }
        }
      });

      document.body.addEventListener('click', () => closeAllMenus());
    })();
    /* ---------- SLIDER ---------- */
    function initSlider() {
      if (!window.RangeSlider) { setTimeout(initSlider, 100); return; }
      sliderInstance = new window.RangeSlider({
        target: document.getElementById('slider'), props: { values: [0, 100000], min: 0, max: 100000, range: true, pips: false, springValues: { stiffness: 0.15, damping: 0.4 } }
      });
      sliderInstance.$on('change', ({ detail }) => {
        const [min, max] = detail.values; priceRange.currentMin = min; priceRange.currentMax = max;
        updatePriceLabels(min, max, priceRange.min, priceRange.max); filterAndRender();
      });
    }
    function updatePriceLabels(vMin, vMax, absMin, absMax) {
      const lblMin = document.getElementById('price-min'); const lblMax = document.getElementById('price-max'); const sliderEl = document.querySelector('#slider .rangeSlider'); if (!sliderEl) return;
      const totalRange = absMax - absMin; if (totalRange <= 0) return;
      lblMin.textContent = Math.round(vMin).toLocaleString('hu-HU') + ' Ft'; lblMax.textContent = Math.round(vMax).toLocaleString('hu-HU') + ' Ft';
      requestAnimationFrame(() => {
        let length = parseFloat(sliderEl.style.getPropertyValue('--slider-length') || 0);
        const minPosPct = ((vMin - absMin) / totalRange) * 100; const maxPosPct = ((vMax - absMin) / totalRange) * 100;
        lblMin.style.setProperty('--pos', minPosPct); lblMin.style.setProperty('--slider-length', length);
        lblMax.style.setProperty('--pos', maxPosPct); lblMax.style.setProperty('--slider-length', length);
        const diff = maxPosPct - minPosPct;
        if (diff < 15) { lblMin.style.transform = 'translateX(-100%)'; lblMax.style.transform = 'translateX(0%)'; }
        else { lblMin.style.transform = 'translateX(-50%)'; lblMax.style.transform = 'translateX(-50%)'; }
      });
    }

    /* ---------- JAVÍTOTT SLIDER LOGIKA (BERAGADÁS ELLEN) ---------- */
    function updateSliderBounds(products) {
      if (!products || products.length === 0) return;

      const prices = products.map(p => parseFloat(p.price)).filter(p => !isNaN(p));
      if (prices.length === 0) return;

      const absMin = Math.floor(Math.min(...prices));
      const absMax = Math.ceil(Math.max(...prices));

      priceRange.min = absMin;
      priceRange.max = absMax;

      if (sliderInstance) {
        sliderInstance.$set({ min: absMin, max: absMax });

        let nextMin = priceRange.currentMin;
        let nextMax = priceRange.currentMax;

        if (isFirstLoad) {
          const urlParams = getUrlParams();
          const urlMin = urlParams.get('minprice');
          const urlMax = urlParams.get('maxprice');

          if (urlMin) nextMin = Number(urlMin);
          else if (nextMin < absMin) nextMin = absMin;

          if (urlMax) nextMax = Number(urlMax);
          else if (nextMax === 0 || (!urlMax && nextMax < absMax)) {
            nextMax = absMax;
          }
        } else {
          if (nextMax === 0 || (nextMin === 0 && nextMax === 0)) {
            nextMin = absMin;
            nextMax = absMax;
          }
        }

        if (nextMin < absMin) nextMin = absMin;
        if (nextMax > absMax) nextMax = absMax;

        priceRange.currentMin = nextMin;
        priceRange.currentMax = nextMax;

        sliderInstance.$set({ values: [nextMin, nextMax] });
        updatePriceLabels(nextMin, nextMax, absMin, absMax);
      }

      isFirstLoad = false;
    }

    /* ---------- API & RENDER ---------- */
    async function fetchProducts(query, page, limit, options = {}) {
      // 1. Megnézzük a DOM-ból a leírás kapcsolót
      const descSearchDom = document.getElementById('descSearch')?.checked || false;
      
      // 2. Összefésüljük a DOM beállítást a paraméterben kapott opciókkal
      // Az options.desc felülírhatja a DOM-ot, ha szükséges, de alapból a DOM nyer, vagy a cat jön options-ből
      const useDesc = (options.desc !== undefined) ? options.desc : descSearchDom;
      const useCat  = (options.cat !== undefined) ? options.cat : false;

      const params = new URLSearchParams({ 
          q: query, 
          page: page, 
          limit: limit, 
          desc: useDesc,
          cat: useCat    // <--- ÚJ: Elküldjük a cat paramétert is
      });
      
      const response = await fetch(`${window.API_BASE}?${params.toString()}`);
      if (!response.ok) throw new Error('Hálózati hiba');
      return await response.json();
    }

    function filterAndRender() {
      const filtered = productsPool.filter(p => {
        const price = parseFloat(p.price); if (isNaN(price)) return false;
        if (price < priceRange.currentMin || (priceRange.currentMax > 0 && price > priceRange.currentMax)) return false;

        // --- OKOSÍTOTT KATEGÓRIA, NÉV ÉS CIKKSZÁM (SKU) SZŰRÉS ---
        if (currentState.categoryFilter) {
          const pCat = (p.category || "").toLowerCase();
          const pName = (p.name || "").toLowerCase();
          const pSku = (p.sku || "").toString().trim();
          
          if (Array.isArray(currentState.categoryFilter)) {
              
              // 1. CIKKSZÁM LISTA DETEKTÁLÁSA (Ha az első elem 'SKU:'-val kezdődik)
              // Példa paraméter: 'SKU:1234, 5678, 9012'
              if (currentState.categoryFilter.length > 0 && currentState.categoryFilter[0].startsWith('SKU:')) {
                  // Levágjuk a "SKU:" előtagot az első elemről
                  const firstSku = currentState.categoryFilter[0].replace('SKU:', '').trim();
                  
                  // Ellenőrizzük, hogy a termék cikkszáma egyezik-e az elsővel, VAGY a lista többi elemével
                  // A többi elem már tisztán cikkszámként kerül a tömbbe a split miatt
                  const isMatch = (pSku === firstSku) || currentState.categoryFilter.slice(1).some(s => s.trim() === pSku);
                  
                  if (!isMatch) return false;
              } 
              
              // 2. HAGYOMÁNYOS SZÖVEGES SZŰRÉS (Kategória vagy Név alapján)
              else {
                  const match = currentState.categoryFilter.some(filterWord => {
                      const fw = filterWord.toLowerCase();
                      // Megnézzük a kategóriában ÉS a névben is!
                      return pCat.includes(fw) || pName.includes(fw);
                  });
                  if (!match) return false;
              }
          } 
        }
        // ------------------------------------------

        return true;
      });
      
      const countEl = document.getElementById('results-count');
      if (countEl) { countEl.style.display = 'block'; countEl.textContent = `Találatok: ${filtered.length} db`; }
      renderProductsList(filtered);
    }

    function renderProductsList(list) {
      const resultsEl = document.getElementById('results'); resultsEl.innerHTML = '';
      const imgOnly = document.getElementById('imgOnly') && document.getElementById('imgOnly').checked;
      let finalList = list;
      if (imgOnly) finalList = list.filter(p => p.img && p.img.length > 0);
      if (finalList.length === 0) { resultsEl.innerHTML = '<div class="no-results">Nincs találat.</div>'; return; }

      const sortVal = document.getElementById('sortSelect').value;
      if (sortVal !== 'relevance') {
        finalList.sort((a, b) => {
          const pA = getPriceData(a).price;
          const pB = getPriceData(b).price;
          
          if (sortVal.includes('price')) { return sortVal === 'price_asc' ? pA - pB : pB - pA; }
          if (sortVal.includes('name')) { const na = (a.name || '').toLowerCase(); const nb = (b.name || '').toLowerCase(); return sortVal === 'name_asc' ? na.localeCompare(nb) : nb.localeCompare(na); }
          if (sortVal === 'name_desc') return (b.name || '').toLowerCase().localeCompare((a.name || '').toLowerCase());
          return 0;
        });
      }

      let row = document.createElement('div'); row.className = 'row';

      finalList.forEach(p => {
        const card = document.createElement('a'); card.className = 'card'; card.href = p.url || '#'; card.target = '_blank'; card.setAttribute('data-glow', '');
        card.onclick = function () { addToViewHistory(p); };
        const bgLayer = document.createElement('div'); bgLayer.className = 'card-bg'; card.appendChild(bgLayer);

        const overlay = document.createElement('div'); overlay.className = 'overlay';
        const img = document.createElement('img'); img.loading = 'lazy';
        const imgs = (p.img || '').toString().split(/\||,|;|\n/).filter(Boolean);
        img.src = imgs.length ? (imgs[0].startsWith('http') ? imgs[0] : 'https://' + imgs[0]) : 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
        overlay.appendChild(img);
        overlay.appendChild(Object.assign(document.createElement('div'), { className: 'name-bar', textContent: p.name || '-' }));

        // --- ÁR MEGJELENÍTÉS ---
        const priceData = getPriceData(p);
        const priceFormatted = Math.round(priceData.price).toLocaleString('hu-HU') + ' Ft';
        
        let priceHtml = '';
        if (priceData.isSale) {
            priceHtml = `<span class="price" style="color:#e60000; font-weight:800;">${priceFormatted}</span>`;
        } else {
            priceHtml = `<span class="price">${priceFormatted}</span>`;
        }

        const meta = document.createElement('div'); meta.className = 'meta';
        meta.innerHTML = `<span class="sku">${p.sku || ''}</span>${priceHtml}`;
        
        card.appendChild(overlay); card.appendChild(meta);

        // KEDVENC GOMB
        const favBtn = document.createElement('div'); favBtn.className = 'fav-icon';
        favBtn.setAttribute('data-sku', p.sku); 
        const isFav = isFavorite(p.sku); if (isFav) favBtn.classList.add('active');
        favBtn.innerHTML = getStarIcon(isFav);
        favBtn.onclick = function (e) { e.preventDefault(); e.stopPropagation(); toggleFavorite(p, this, card.querySelector('img')); };
        card.appendChild(favBtn);

        // LEÍRÁS GOMB (SZEM IKON)
        const descBtn = document.createElement('div');
        descBtn.className = 'desc-icon';
        descBtn.setAttribute('aria-label', 'Rövid leírás');
        // SVG ikon
        descBtn.innerHTML = `<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>`;
        
        descBtn.onclick = function (e) {
          e.preventDefault();
          e.stopPropagation();
          openDescModal(p);
        };
        card.appendChild(descBtn);

        row.appendChild(card);
      });
      resultsEl.appendChild(row);

      if (currentState.hasMore) createLoadMoreButton(); else removeLoadMoreButton();
      if (window.attachCardPointer) window.attachCardPointer();
    }

    async function renderForQuery(q, isManualSearch = false, isHistoryNav = false) {
      const resultsEl = document.getElementById('results'); 
      const countEl = document.getElementById('results-count');
      
      // Ellenőrzés: van-e elég karakter
      if (!q || q.trim().length < MIN_TOKEN_LEN) { 
          resultsEl.innerHTML = '<div class="no-results">Írjon legalább ' + MIN_TOKEN_LEN + ' karaktert.</div>'; 
          if (countEl) countEl.style.display = 'none'; 
          removeLoadMoreButton(); 
          return; 
      }

      currentState.query = q.trim(); 
      currentState.page = 1; 
      productsPool = [];

      if (isManualSearch) {
        // Resetelünk mindent, mert ez egy új, kézi keresés
        priceRange.currentMin = 0;
        priceRange.currentMax = 0;
        currentState.categoryFilter = null;
        
        // --- JAVÍTÁS ITT: KIKAPCSOLJUK A KATEGÓRIA KERESÉST ---
        currentState.isCategorySearch = false; 
        // ------------------------------------------------------

        document.getElementById('category-toggle').textContent = "Kategória: Összes";

        isFirstLoad = false;

        if (!isHistoryNav) {
          updateBrowserHistory(currentState.query, 0, 0);
        }
      }

      resultsEl.innerHTML = '<div class="loading">Keresés...</div>'; 
      if (countEl) countEl.style.display = 'none';

      try {
        // Sima keresés indítása (nem küldünk cat: true opciót)
        const data = await fetchProducts(currentState.query, 1, 500);
        productsPool = data.results;

        updateCategoryDropdown(productsPool);

        if (data.results.length > 0) addToSearchHistory(currentState.query);
        
        // Load More gomb kezelése
        if (data.total_count > 500) { currentState.hasMore = true; } else { currentState.hasMore = false; }
        
        if (productsPool.length === 0) { 
            resultsEl.innerHTML = '<div class="no-results">Nincs találat.</div>'; 
            return; 
        }
        resultsEl.innerHTML = '';

        updateSliderBounds(productsPool);
        filterAndRender();
        
        // Görgetés a találatokhoz
        if (productsPool.length > 0) {
          setTimeout(() => {
            const controlsRow = document.querySelector('.controls-row');
            if (controlsRow) {
              controlsRow.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }, 100); 
        }
      } catch (err) { 
          console.error(err); 
          resultsEl.innerHTML = '<div class="no-results">Hiba történt: ' + err.message + '</div>'; 
      }
    }

    async function loadMore() {
      if (currentState.isLoading || !currentState.hasMore) return;
      
      const btnContent = document.querySelector('.fancy-btn .btn-content'); 
      if (btnContent) btnContent.textContent = 'Betöltés...';
      
      currentState.isLoading = true;
      try {
        currentState.page++;
        
        // JAVÍTÁS: Átadjuk a 'cat' opciót, ha kategória alapú volt a keresés
        const options = { cat: currentState.isCategorySearch };
        
        const data = await fetchProducts(currentState.query, currentState.page, 500, options);
        productsPool = [...productsPool, ...data.results];

        updateCategoryDropdown(productsPool);
        updateSliderBounds(productsPool);
        if (data.total_count <= productsPool.length) currentState.hasMore = false;
        
        filterAndRender(); // Ez a függvény már az új szűrési logikát fogja használni (lásd lejjebb)
        
      } catch (err) { 
          console.error(err); 
          if (btnContent) btnContent.textContent = 'Hiba (próbáld újra)'; 
          // Hiba esetén visszalépünk egy oldalt, hogy újra próbálhassa
          currentState.page--;
      } finally { 
          currentState.isLoading = false; 
          // Ha sikeres volt, visszaírjuk a gomb szövegét (a filterAndRender úgyis kezeli a gomb létét)
          if(currentState.hasMore && btnContent) btnContent.textContent = 'További találatok';
      }
    }

    function createLoadMoreButton() {
      removeLoadMoreButton();
      const btnContainer = document.createElement('div'); btnContainer.id = 'loadMoreContainer'; btnContainer.className = 'fancy-btn-container';
      const btn = document.createElement('button'); btn.id = 'loadMoreBtn'; btn.className = 'fancy-btn'; btn.onclick = loadMore;
      const cellsDiv = document.createElement('div'); cellsDiv.className = 'btn-cells'; for (let i = 0; i < 20; i++) { cellsDiv.appendChild(document.createElement('span')); }
      const contentSpan = document.createElement('span'); contentSpan.className = 'btn-content'; contentSpan.textContent = 'További találatok';
      btn.appendChild(cellsDiv); btn.appendChild(contentSpan); btnContainer.appendChild(btn);
      document.getElementById('results').parentNode.insertBefore(btnContainer, document.getElementById('results').nextSibling);
    }
    function removeLoadMoreButton() { const el = document.getElementById('loadMoreContainer'); if (el) el.remove(); }

    function attachCardPointer() {
      const cards = Array.from(document.querySelectorAll('.card[data-glow]'));
      cards.forEach(card => {
        if (card._glowPointerAttached) return; card._glowPointerAttached = true;
        let onMove = (ev) => {
          const rect = card.getBoundingClientRect();
          const x = Math.max(0, Math.min(rect.width, ev.clientX - rect.left));
          const y = Math.max(0, Math.min(rect.height, ev.clientY - rect.top));
          card.style.setProperty('--x', x.toFixed(2)); card.style.setProperty('--xp', (x / rect.width).toFixed(3));
          card.style.setProperty('--y', y.toFixed(2)); card.style.setProperty('--yp', (y / rect.height).toFixed(3));
        };
        card.addEventListener('pointermove', onMove, { passive: true }); card.addEventListener('pointerenter', onMove);
      });
    }

    /* =========================================
       ÚJ: RÖVID LEÍRÁS MODAL LOGIKA (OKOS ADATOKKAL)
       ========================================= */

    /* =========================================
       JAVÍTOTT MODAL LOGIKA (Seeded RNG + Smart Shipping)
       ========================================= */

    // 1. Segédfüggvény: Hányadik hét van most? (Hogy hetente változzon a szám)
    function getWeekNumber() {
        const d = new Date();
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    // 2. Saját véletlenszám generátor (Seed based)
    // Ez a függvény mindig UGYANAZT a számot adja vissza (0 és 1 között), 
    // ha ugyanazt a 'seed'-et (magot) kapja bemenetnek.
    function seededRandom(seed) {
        var x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
    }

    // 3. A TE EREDETI LOGIKÁD, de "stabil" számokkal
    function getSalesCount(price, sku) {
        // A "seed" (mag) létrehozása: Cikkszám + Év + Hét
        // Így egy adott terméknél, egy adott héten mindig ugyanaz a véletlen szám jön ki.
        const currentWeek = getWeekNumber();
        
        // A cikkszámot számmá alakítjuk (hash)
        let hash = 0;
        const str = sku + "_" + currentWeek;
        for (let i = 0; i < str.length; i++) {
            hash = ((hash << 5) - hash) + str.charCodeAt(i);
            hash |= 0;
        }
        let seed = Math.abs(hash); // Ez lesz a kiinduló számunk

        // BELSŐ FÜGGVÉNY: Math.random() helyett ezt használjuk
        // Minden hívásnál növeljük a seed-et, hogy a következő százalékvizsgálat más legyen
        function myRandom() {
            seed++; 
            return seededRandom(seed);
        }

        /* --- INNENTŐL A TE EREDETI LOGIKÁD (Csak Math.random() -> myRandom()-ra cserélve) --- */
        const now = new Date();
        const month = now.getMonth(); // 0 = Január ... 8 = Szeptember
        
        // Magas szezon: Március (2) - Szeptember (8)
        const isHighSeason = (month >= 2 && month <= 8);
        const isCheap = (price < 40000);

        if (isHighSeason) {
            // --- FŐSZEZON ---
            if (isCheap) {
                // Olcsó: 15% esély a 0-ra
                if (myRandom() < 0.15) return 0; 
                return Math.floor(myRandom() * 7) + 1; 
            } else {
                // Drága
                const r = myRandom();
                if (r < 0.4) return 0;  // 40% esély 0
                if (r < 0.8) return 1;  // 40% esély 1
                if (r < 0.95) return 2; // 15% esély 2
                return 3;               // 5% esély 3
            }
        } else {
            // --- HOLTSZEZON ---
            if (isCheap) {
                // Olcsó
                if (myRandom() < 0.5) return 0;
                return Math.floor(myRandom() * 3) + 1;
            } else {
                // Drága
                const r = myRandom();
                if (r < 0.85) return 0; 
                if (r < 0.98) return 1; 
                return 2;              
            }
        }
    }

    function openDescModal(product) {
      const modalOverlay = document.getElementById('desc-modal-overlay');
      const modalTitle = document.getElementById('desc-modal-title');
      const modalContent = document.getElementById('desc-modal-content');

      const modalImg = document.getElementById('modal-img');
      const modalPrice = document.getElementById('modal-price');
      const modalWarranty = document.getElementById('modal-warranty');
      const modalSales = document.getElementById('modal-sales');
      const modalFavBtn = document.getElementById('modal-fav-btn');
      const modalLinkBtn = document.getElementById('modal-link-btn');
      
      const shippingBlock = document.querySelector('.shipping-block');

      if (modalOverlay && modalTitle && modalContent) {
        modalTitle.textContent = product.name;
        
        let dbDesc = product.short_description || "";
        dbDesc = dbDesc.replace(/<!HTML KOD>/gi, "").trim();
        if (dbDesc && dbDesc.length > 0) {
             modalContent.innerHTML = dbDesc; 
        } else {
             modalContent.innerText = "Ehhez a termékhez jelenleg nincs részletes leírás.";
        }

        const imgs = (product.img || '').toString().split(/\||,|;|\n/).filter(Boolean);
        modalImg.src = imgs.length ? (imgs[0].startsWith('http') ? imgs[0] : 'https://' + imgs[0]) : 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';

        const priceData = getPriceData(product);
        const priceFormatted = Math.round(priceData.price).toLocaleString('hu-HU') + ' Ft';
        
        if (priceData.isSale) {
            const originalFormatted = Math.round(priceData.originalPrice).toLocaleString('hu-HU') + ' Ft';
            modalPrice.innerHTML = `
                <div style="display:flex; flex-direction:column; align-items:flex-start; line-height:1.2;">
                    <span style="text-decoration:line-through; font-size:14px; color:#999;">${originalFormatted}</span>
                    <span style="color:#e60000; font-size:22px;">${priceFormatted}</span>
                </div>`;
        } else {
            modalPrice.textContent = priceFormatted;
        }

        /* --- JAVÍTOTT SZÁLLÍTÁS LOGIKA --- */
        const catLower = (product.category || "").toLowerCase();
        const priceVal = priceData.price;
        let showShipping = true;

        // 1. Tiltólistás szavak
        const forbiddenWords = ["hajó", "csónak", "sit on top", "hagyományos kajak-kenu"];
        
        // CSAK AKKOR tiltjuk le, ha drágább mint 40.000 Ft. 
        // Így az olcsó kiegészítők (pl. "Hajócsavar", "Csónak ragasztó") megkapják a szállítást.
        if (priceVal > 40000) { 
            for (let word of forbiddenWords) {
                if (catLower.includes(word)) {
                    showShipping = false;
                    break;
                }
            }
        }

        // 2. Tréler speciális logika (csak 100.000 Ft felett rejtjük el)
        if (showShipping && catLower.includes("tréler")) {
            if (priceVal > 100000) {
                showShipping = false;
            }
        }

        if (shippingBlock) {
            shippingBlock.style.display = showShipping ? 'flex' : 'none';
        }
        /* ----------------------------------------------------- */

        // Garancia logika
        const name = (product.name || '').toLowerCase();
        let warrantyText = "1 év garancia"; 
        if (name.includes('deeper chirp') || name.includes('tohatsu')) {
          warrantyText = "5 év garancia";
        } else {
          if (priceVal > 250000) warrantyText = "3 év garancia";
          else if (priceVal > 10000) warrantyText = "2 év garancia";
          else warrantyText = "1 év garancia";
        }
        modalWarranty.textContent = warrantyText;

        const salesCount = getSalesCount(priceVal, product.sku);
        modalSales.textContent = `${salesCount} db eladva az elmúlt 30 napban`;

        modalLinkBtn.href = product.url || '#';
        const isFav = isFavorite(product.sku);
        if (isFav) modalFavBtn.classList.add('active');
        else modalFavBtn.classList.remove('active');
        modalFavBtn.innerHTML = getStarIcon(isFav);

        modalFavBtn.onclick = function () {
          toggleFavorite(product, this, null);
        };

        modalOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';

        setTimeout(initCustomScrollbar, 50);
      }
    }

    window.closeDescModal = function () {
      const modalOverlay = document.getElementById('desc-modal-overlay');
      if (modalOverlay) {
        modalOverlay.classList.remove('active');
        document.body.style.overflow = '';
      }
    };

    function initCustomScrollbar() {
      const content = document.querySelector('.desc-content');
      const scrollbarThumb = document.querySelector('.scrollbar-thumb');
      const scrollbarTrack = document.querySelector('.scrollbar-track');

      if (!content || !scrollbarThumb || !scrollbarTrack) return;

      function updateScrollbar() {
        const contentHeight = content.scrollHeight;
        const containerHeight = content.clientHeight;
        if (contentHeight <= containerHeight) {
          scrollbarTrack.style.display = 'none';
        } else {
          scrollbarTrack.style.display = 'block';
          const thumbHeight = (containerHeight / contentHeight) * containerHeight;
          scrollbarThumb.style.height = `${thumbHeight}px`;
        }
      }

      content.addEventListener('scroll', () => {
        const scrollTop = content.scrollTop;
        const contentHeight = content.scrollHeight;
        const containerHeight = content.clientHeight;
        const trackHeight = scrollbarTrack.clientHeight;
        const thumbHeight = scrollbarThumb.clientHeight;

        const scrollPercentage = scrollTop / (contentHeight - containerHeight);
        const thumbTop = scrollPercentage * (trackHeight - thumbHeight);
        scrollbarThumb.style.top = `${thumbTop}px`;
      });

      let isDragging = false;
      let startY;
      let startTop;

      scrollbarThumb.addEventListener('mousedown', (e) => {
        isDragging = true;
        startY = e.clientY;
        startTop = parseInt(window.getComputedStyle(scrollbarThumb).top, 10) || 0;
        document.body.style.userSelect = 'none';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        const deltaY = e.clientY - startY;
        const trackHeight = scrollbarTrack.clientHeight;
        const thumbHeight = scrollbarThumb.clientHeight;
        let newTop = startTop + deltaY;

        newTop = Math.max(0, Math.min(newTop, trackHeight - thumbHeight));

        const scrollPercentage = newTop / (trackHeight - thumbHeight);
        const contentHeight = content.scrollHeight;
        const containerHeight = content.clientHeight;

        content.scrollTop = scrollPercentage * (contentHeight - containerHeight);
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        document.body.style.userSelect = '';
      });

      updateScrollbar();
      window.addEventListener('resize', updateScrollbar);
    }


    (function wireEvents() {
      var qInput = document.getElementById('q'); var timer = null;
      if (qInput) {
        qInput.addEventListener('input', function (e) {
          clearTimeout(timer); timer = setTimeout(function () { renderForQuery(e.target.value, true); }, 500);
        });
      }
      document.getElementById('sortSelect').addEventListener('change', filterAndRender);
      document.getElementById('imgOnly').addEventListener('change', filterAndRender);
      // ÚJ: Ha a leírás checkbox változik, ÚJRA KELL HÍVNI az API-t (nem elég a filterAndRender)
      const descCheckbox = document.getElementById('descSearch');
      if (descCheckbox) {
        descCheckbox.addEventListener('change', function () {
          // Újraküldjük a keresést a jelenlegi kulcsszóval
          const currentQ = document.getElementById('q').value;
          if (currentQ && currentQ.length >= window.MIN_TOKEN_LEN) {
            renderForQuery(currentQ, true);
          }
        });
      }
    })();

    /* =========================================
       AKTUÁLIS GALÉRIA LOGIKA (2 LÉPCSŐS KLIKK)
       ========================================= */
    
    function toggleGallery() {
        const section = document.getElementById('gallery-section');
        const btn = document.getElementById('currentBtn');
        const isOpen = section.classList.contains('open');

        if (isOpen) {
            closeGallery();
        } else {
            section.classList.add('open');
            btn.classList.add('active');
            
            // Ha a kategória menü nyitva van, csukjuk be
            const catWrap = document.getElementById('searchWrapper');
            if(catWrap) catWrap.classList.remove('menu-active');
        }
    }

    /* =========================================
       TOP KATEGÓRIÁK LOGIKA
       ========================================= */
    
    // 1. A FŐ GOMB NYITÁSA/CSUKÁSA
    function toggleTopCategories() {
        const section = document.getElementById('top-cat-section');
        const btn = document.getElementById('topCatBtn');
        const isOpen = section.classList.contains('open');

        if (isOpen) {
            section.classList.remove('open');
            btn.classList.remove('active');
        } else {
            // Először zárjuk be a galériát, ha nyitva van
            if(document.getElementById('gallery-section').classList.contains('open')) {
                closeGallery();
            }
            section.classList.add('open');
            btn.classList.add('active');
        }
    }

    // 2. SZINT KEZELÉSE (Ha rákattintasz az egyikre, nyíljon meg alatta a sora)
    window.handleTopCatChange = function(checkbox, targetId) {
        // Ha ezt bepipálták, akkor a TÖBBI hasonlót ki kell venni (radio button viselkedés)
        if(checkbox.checked) {
            const allInputs = document.querySelectorAll('input[name="top_level_1"]');
            allInputs.forEach(input => {
                if(input !== checkbox) input.checked = false;
            });
        }

        // Az összes al-panelt elrejtjük
        document.querySelectorAll('.cat-sub-level').forEach(el => el.style.display = 'none');

        // Ha be van pipálva, megjelenítjük a hozzá tartozót
        if(checkbox.checked) {
            const target = document.getElementById(targetId);
            if(target) {
                target.style.display = 'flex';
                // Kis animáció triggerelése újra
                target.style.animation = 'none';
                target.offsetHeight; /* trigger reflow */
                target.style.animation = 'fadeIn 0.4s ease-out';
            }
        }
    };

    // 3. KERESÉS INDÍTÁSA A 2. SZINTRŐL
    window.triggerSearch = function(keyword) {
        // Bezárjuk a panelt
        toggleTopCategories();
        
        // Beírjuk a keresőbe és keresünk
        const qInput = document.getElementById('q');
        qInput.value = keyword;
        renderForQuery(keyword, true);
    };

    // + Kiegészítés: Ha a galériát nyitjuk, ez csukódjon be (tedd ezt a toggleGallery-be!)
    // A toggleGallery függvényed elejére írd be: 
    // const topCat = document.getElementById('top-cat-section');
    // if(topCat && topCat.classList.contains('open')) toggleTopCategories();

    function closeGallery() {
        const section = document.getElementById('gallery-section');
        const btn = document.getElementById('currentBtn');
        const items = document.querySelectorAll('.gallery-item');
        
        section.classList.remove('open');
        btn.classList.remove('active');
        
        // Reseteljük a képek állapotát is
        items.forEach(item => item.classList.remove('active'));
    }

    // Inicializálás
    document.addEventListener('DOMContentLoaded', () => {
        const galleryItems = document.querySelectorAll('.gallery-item');
        
        galleryItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.stopPropagation(); // Ne csukja be a galériát azonnal
                
                // 1. lépés: Ha még nem aktív, akkor kinyitjuk (active class)
                if (!item.classList.contains('active')) {
                    // Először csukjuk be a többit
                    galleryItems.forEach(sib => sib.classList.remove('active'));
                    item.classList.add('active');
                } 
                // 2. lépés: Ha már aktív, akkor megnyitjuk a linket
                else {
                    const url = item.getAttribute('data-url');
                    if (url) {
                        window.open(url, '_blank');
                    }
                }
            });
        });

        // Kattintás kívülre -> Bezárás
        document.addEventListener('click', (e) => {
            const section = document.getElementById('gallery-section');
            const btn = document.getElementById('currentBtn');
            
            if (section.classList.contains('open')) {
                // Ha nem a galériára és nem a gombra kattintottunk
                if (!section.contains(e.target) && !btn.contains(e.target)) {
                    closeGallery();
                }
            }
        });
        
        // Ha a "Kategóriák" gombra kattintunk, zárjuk be a galériát (hogy ne legyen nyitva mindkettő)
        const catBtn = document.getElementById('catMenuBtn');
        if(catBtn) {
            catBtn.addEventListener('click', () => {
                const section = document.getElementById('gallery-section');
                if(section.classList.contains('open')) closeGallery();
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
      initSlider();

      const urlParams = getUrlParams();
      const queryParam = urlParams.get('q');
      const minPriceParam = urlParams.get('minprice');
      const maxPriceParam = urlParams.get('maxprice');

      if (queryParam) {
        const qInput = document.getElementById('q');
        qInput.value = queryParam;

        if (minPriceParam) priceRange.currentMin = Number(minPriceParam);
        if (maxPriceParam) priceRange.currentMax = Number(maxPriceParam);

        setTimeout(() => {
          if (sliderInstance && (minPriceParam || maxPriceParam)) {
            sliderInstance.$set({
              values: [priceRange.currentMin, priceRange.currentMax]
            });
          }
          renderForQuery(queryParam, false);
        }, 500);
      }

      var prodBtn = document.getElementById('prodBtn'); var catBtn = document.getElementById('catBtn');
      if (prodBtn) prodBtn.addEventListener('click', function (e) { e.preventDefault(); prodBtn.classList.add('active'); catBtn.classList.remove('active'); });
      if (catBtn) catBtn.addEventListener('click', function (e) { e.preventDefault(); window.location.href = 'kepes_kereso_site.html'; });
      updateSidebarUI();
    });
    async function filterByCategories(card, searchTerm, categoriesStr) {
        // 1. Vizuális reset
        document.querySelectorAll('.cat-sub-level .cat-card').forEach(c => c.classList.remove('active-sub'));
        card.classList.add('active-sub');

        // 2. Filter beállítása
        const categoryList = categoriesStr.split(',').map(s => s.trim());
        currentState.categoryFilter = categoryList;
        currentState.query = searchTerm;      
        currentState.isCategorySearch = true; 
        currentState.page = 1;
        currentState.hasMore = true; 

        // Gomb szöveg frissítése
        const catBtn = document.getElementById('category-toggle');
        if(catBtn) catBtn.textContent = "Kategória: " + categoryList[0] + (categoryList.length > 1 ? "..." : "");

        const resultsEl = document.getElementById('results');
        resultsEl.innerHTML = '<div class=\"loading\">Termékek betöltése kategória alapján...</div>';
        
        productsPool = []; 

        try {
            const data = await fetchProducts(searchTerm, 1, 500, { cat: true });
            productsPool = data.results;
            
            if (data.total_count > productsPool.length) { currentState.hasMore = true; } else { currentState.hasMore = false; }
            
            if(productsPool.length > 0) {
                // Árak számítása
                const prices = productsPool.map(p => parseFloat(p.price)).filter(x => !isNaN(x));
                const min = prices.length ? Math.min(...prices) : 0;
                const max = prices.length ? Math.max(...prices) : 0;

                // --- SPECIÁLIS MINIMUM ÁRAK ---
                let forcedMin = min; 
                if (categoriesStr.includes('Torqeedo') || categoriesStr.includes('Spirit')) forcedMin = 200000;
                else if (categoriesStr.includes('Osapian') || categoriesStr.includes('Protruar')) forcedMin = 58000;
                else if (categoriesStr.includes('Cayman') || categoriesStr.includes('Terrova')) forcedMin = 190000;
                else if (categoriesStr.includes('Gumicsónak') || categoriesStr.includes('Kolibri')) forcedMin = 150000;

                if (forcedMin > max) forcedMin = min; 
                
                priceRange.currentMin = forcedMin;
                priceRange.currentMax = max;

                updateSliderBounds(productsPool); 
                if (sliderInstance) {
                    sliderInstance.$set({ values: [forcedMin, max] }); 
                }

                // --- JAVÍTOTT RÉSZ: ELŐSZŰRÉS A DROPDOWN SZÁMÁRA ---
                // Itt szűrjük le a termékeket ugyanazzal a logikával, amit a megjelenítéshez használunk,
                // így a legördülő menübe nem kerülnek bele az irreleváns kategóriák.
                const filteredForDropdown = productsPool.filter(p => {
                     const pCat = (p.category || "").toLowerCase();
                     const pName = (p.name || "").toLowerCase();
                     const pSku = (p.sku || "").toString().trim();

                     // SKU alapú szűrés ellenőrzése
                     if (categoryList.length > 0 && categoryList[0].startsWith('SKU:')) {
                          const firstSku = categoryList[0].replace('SKU:', '').trim();
                          return (pSku === firstSku) || categoryList.slice(1).some(s => s.trim() === pSku);
                     } 
                     // Szöveges szűrés ellenőrzése
                     else {
                          return categoryList.some(filterWord => {
                              const fw = filterWord.toLowerCase();
                              return pCat.includes(fw) || pName.includes(fw);
                          });
                     }
                });

                // Most már a tisztított listát adjuk át
                updateCategoryDropdown(filteredForDropdown);
                // ----------------------------------------------------

                filterAndRender(); 
                
                setTimeout(() => {
                    const controlsRow = document.querySelector('.controls-row');
                    if(controlsRow) controlsRow.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            } else {
                resultsEl.innerHTML = '<div class=\"no-results\">Nincs találat ebben a kategóriában.</div>';
                removeLoadMoreButton();
                // Üres lista esetén a dropdown is legyen üres vagy alaphelyzet
                updateCategoryDropdown([]);
            }
            
        } catch(err) {
            console.error(err);
            resultsEl.innerHTML = '<div class=\"no-results\">Hiba történt.</div>';
        }
    }
    /* =========================================
       WIDGET LOGIKA START
       ========================================= */
    // === KONFIGURÁCIÓ ===
const CONTACT_PHONE_NUMBER = "+36123456789"; // Cseréld le a valós számra
const CONTACT_PHONE_DISPLAY = "+36 1 234 56789"; // Szépen formázott kiírás


// === MODÁLIS ABLAK KEZELÉS ===

// Modális megnyitása ID alapján
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        // A body görgetésének tiltása, amíg a modális nyitva van
        document.body.style.overflow = 'hidden';
    }
}

// Modális bezárása ID alapján
function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        // Görgetés engedélyezése újra
        document.body.style.overflow = '';
    }
}

// Bezárás, ha a sötét háttérre (overlay) kattintunk
function closeModalIfOutside(event, modalId) {
    const modal = document.getElementById(modalId);
    // Ha a kattintás célpontja maga az overlay (és nem a belső content)
    if (event.target === modal) {
        closeModal(modalId);
    }
}

// Esc gomb megnyomására is zárjuk be az aktív modálist
document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") {
        const activeModal = document.querySelector('.modal-overlay.active');
        if (activeModal) {
            closeModal(activeModal.id);
        }
    }
});


// === TELEFON GOMB LOGIKA ===

// === TELEFON GOMB LOGIKA ===
const phoneBtn = document.getElementById('phoneBtn');

phoneBtn.addEventListener('click', function() {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    if (isMobile) {
        // Mobilon továbbra is azonnal tárcsáz
        window.location.href = `tel:${CONTACT_PHONE_NUMBER}`;
    } else {
        // Asztali gépen most már a szép popupot nyitjuk meg
        openModal('phoneModal');
    }
});

// === ŰRLAP BEKÜLDÉS (Formspree AJAX) ===
const contactForm = document.getElementById('contactForm');

contactForm.addEventListener('submit', function(event) {
    event.preventDefault(); // Megakadályozzuk az oldal újratöltését

    const form = event.target;
    const data = new FormData(form);
    
    // Gomb állapotának kezelése (Loading...)
    const submitBtn = form.querySelector('.submit-btn');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = 'Küldés...';
    submitBtn.disabled = true; // Dupla kattintás ellen

    // --- IDE MÁSOLD BE A SAJÁT FORMSPREE LINKEDET ---
    const formspreeUrl = "https://formspree.io/f/myzrpbnl"; 

    fetch(formspreeUrl, {
        method: "POST",
        body: data,
        headers: {
            'Accept': 'application/json'
        }
    }).then(response => {
        if (response.ok) {
            // SIKERES KÜLDÉS - Zöld pipás animáció
            submitBtn.innerHTML = '<span class="material-icons">check</span> Elküldve!';
            submitBtn.style.backgroundColor = '#4CAF50'; // Zöld szín
            
            // Űrlap törlése
            contactForm.reset();

            setTimeout(() => {
                // 2 másodperc múlva bezárjuk a modálist és visszaállítjuk a gombot
                closeModal('formModal');
                
                // Gomb visszaállítása eredeti állapotra
                submitBtn.innerHTML = originalText;
                submitBtn.style.backgroundColor = '';
                submitBtn.disabled = false;
            }, 2000);
            
        } else {
            // HIBAKEZELÉS (Ha a Formspree hibát dob)
            response.json().then(data => {
                if (Object.hasOwn(data, 'errors')) {
                    alert("Hiba: " + data["errors"].map(error => error["message"]).join(", "));
                } else {
                    alert("Hiba történt a küldéskor.");
                }
                // Gomb visszaállítása, hogy újra próbálhassa
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }
    }).catch(error => {
        // HÁLÓZATI HIBA
        alert("Hálózati hiba történt. Kérjük, ellenőrizze internetkapcsolatát!");
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});
  // === TÉMA SZINKRONIZÁLÓ ===
  document.addEventListener('DOMContentLoaded', () => {
    const themeRadios = document.querySelectorAll('input[name="theme"]');

    // Ha kattintasz a váltóra
    themeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.value === 'dark') {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      });
    });

    // Ha frissítés után alapból sötét volt a beállítás
    const darkRadio = document.querySelector('input[name="theme"][value="dark"]');
    if (darkRadio && darkRadio.checked) {
      document.body.classList.add('dark-mode');
    }
  });   
  </script>
</body>

</html>
